define(["jquery","qlik","text!./css/style.css","./js/fingerprint2","./js/bi_mappings"],function($,qlik,style,Fingerprint2){"use strict";$("<style>").html(style).appendTo("head");let defaultApiEndpoint="https://bi.prod.arria.com/",apiEndpoint=defaultApiEndpoint;var authorizationValue="Yml3cmFwcGVyOnc/R2NkZzdl";let supportURL="https://samples.studio.arria.com/bi-ai-for-qlik/",OOTBGenerateEndPoint="https://eut3hmitn2.execute-api.us-east-1.amazonaws.com/release-1-1-1/arriatestootbglooapi",OOTBEndPointAPIKey="MCrD8Y2tOQ2BhpjkrpW5q1ybQIA2h6vi84xhdEkd",OOTBEndPoint="https://jxczzc66qa.execute-api.us-east-1.amazonaws.com/prod/",OOTBEndPointKey="YXH7gK57Wv5Ld213gci3YaTttaca0EDi85miLX07",entityType={entityTypes:[]},measureEntityType={entityTypes:[]};var narrationCall=!0,selColstrack={},debounce=!1,copyChartID="",copyToClipBoardFlag=!1,url_Pattern=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/,dragSrcEl=null,drillDownFilter=!1,fieldUpdate=!1,autoIncrementID=!0,presistSimplecheck="",presistAdvanceCheck="",maximize=!1,fingerPrintKey="",projectArgumentsNarrative={};function convertToCSV(e){for(var t="object"!=typeof e?JSON.parse(e):e,a="",n=0;n<t.length;n++){var i="";for(var l in t[n])""!=i&&(i+=","),i+=t[n][l];a+=i+"<br>"}return a}function getEntitiesForOOTB(){try{let e=new XMLHttpRequest;e.onreadystatechange=function(){4===this.readyState&&200===this.status&&""!==e.responseText&&(entityType=JSON.parse(e.responseText))},e.onerror=function(e){},e.open("GET",OOTBEndPoint+"ootb/entitytypesfordims"),e.setRequestHeader("x-api-key",OOTBEndPointKey),window.navigator.onLine&&e.send();let t=new XMLHttpRequest;t.onreadystatechange=function(){4===this.readyState&&200===this.status&&""!==t.responseText&&(measureEntityType=JSON.parse(t.responseText))},t.onerror=function(e){},t.open("GET",OOTBEndPoint+"ootb/entitytypesformeasures"),t.setRequestHeader("x-api-key",OOTBEndPointKey),window.navigator.onLine&&t.send()}catch(e){console.log(e)}}function getFingerPrintKey(){if(""===fingerPrintKey){new Fingerprint2({excludeScreenResolution:!0,excludeAvailableScreenResolution:!0}).get(function(e,t){fingerPrintKey=e})}}function createNarrativeUI(e,t,a){let n="";n+="/*\n",n+="* function to modify data in standard BI format.\n",n+="* @return a JSON object.\n",n+="*/\n";var i="";i+='<div class="container qlik-container" id="qlikContainer'+e+'">',i+='<header class="col-md-12" id="header'+e+'">',i+='<div class="col-md-12 tab-header"> ',i+='<button type="button" id="box-tab'+e+'">Configure Narrative</button> <button class="narrative-tab" type="button" id="narrative-tab'+e+'">Create Custom Narrative</button>',i+='<a href="javascript:void(0);" id="documentBtn'+e+'" class="documentBtn">Documentation</a>',i+="</div>",i+="</header>",i+="<section>",i+='<div class="outofbox-tabsection" id="outofbox-tabsection'+e+'" style="display:block">',i+='<div class="header">',i+='<a href="javascript:void(0)" class="previous" style="display:none;"><img src="'+apiEndpoint+'arria/images/arrow_left.png">Previous</a>',i+='<a href="javascript:void(0)" class="next" style="display:block;">Next<img src="'+apiEndpoint+'arria/images/arrow_right.png"></a>',i+='<div class="slide"><ul><li class="active" id="slide1'+e+'"></li><li id="slide2'+e+'"></li><li id="slide3'+e+'"></li></ul></div>',i+="<p>1.Tell me about your data</p>",i+="</div>",i+='<div class="tell-data" id="tell-data'+e+'" style="display:block">',i+="</div>",i+='<div class="tell-what" id="tell-what'+e+'" style="display:none">',i+='<div class="card">',i+='<div class="card-header statistics"><input type="checkbox">Descriptive statistics (avg, min, max) <img src="data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxMjkgMTI5IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAxMjkgMTI5IiB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxNnB4Ij4KICA8Zz4KICAgIDxwYXRoIGQ9Im0xMjEuMywzNC42Yy0xLjYtMS42LTQuMi0xLjYtNS44LDBsLTUxLDUxLjEtNTEuMS01MS4xYy0xLjYtMS42LTQuMi0xLjYtNS44LDAtMS42LDEuNi0xLjYsNC4yIDAsNS44bDUzLjksNTMuOWMwLjgsMC44IDEuOCwxLjIgMi45LDEuMiAxLDAgMi4xLTAuNCAyLjktMS4ybDUzLjktNTMuOWMxLjctMS42IDEuNy00LjIgMC4xLTUuOHoiIGZpbGw9IiM2NjY2NjYiLz4KICA8L2c+Cjwvc3ZnPgo=" /></div>',i+='<div class="card-content text-center col-md-12"><div class="col-md-6 text-left"><input type="checkbox"><label>Data driven (ANOVA based ranking)</label> </div><div class="col-md-6 text-left"><input type="checkbox"><label>Include distribution analysis</label> </div></div>',i+="</div>",i+='<div class="card">',i+='<div class="card-header time"><input type="checkbox">Time series (trends) <img src="data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxMjkgMTI5IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAxMjkgMTI5IiB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxNnB4Ij4KICA8Zz4KICAgIDxwYXRoIGQ9Im0xMjEuMywzNC42Yy0xLjYtMS42LTQuMi0xLjYtNS44LDBsLTUxLDUxLjEtNTEuMS01MS4xYy0xLjYtMS42LTQuMi0xLjYtNS44LDAtMS42LDEuNi0xLjYsNC4yIDAsNS44bDUzLjksNTMuOWMwLjgsMC44IDEuOCwxLjIgMi45LDEuMiAxLDAgMi4xLTAuNCAyLjktMS4ybDUzLjktNTMuOWMxLjctMS42IDEuNy00LjIgMC4xLTUuOHoiIGZpbGw9IiM2NjY2NjYiLz4KICA8L2c+Cjwvc3ZnPgo=" /></div>',i+='<div class="card-content text-center">',i+='<div class="col-md-8"><span>Cluster Distance</span> 0<input type="range" min="1" max="100" value="50" class="range-slide">100<span class="slide-span"></span></div>',i+="</div>",i+="</div>",i+='<div class="card">',i+='<div class="card-header groupings"><input type="checkbox">Important groupings (clusters) <img src="data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxMjkgMTI5IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAxMjkgMTI5IiB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxNnB4Ij4KICA8Zz4KICAgIDxwYXRoIGQ9Im0xMjEuMywzNC42Yy0xLjYtMS42LTQuMi0xLjYtNS44LDBsLTUxLDUxLjEtNTEuMS01MS4xYy0xLjYtMS42LTQuMi0xLjYtNS44LDAtMS42LDEuNi0xLjYsNC4yIDAsNS44bDUzLjksNTMuOWMwLjgsMC44IDEuOCwxLjIgMi45LDEuMiAxLDAgMi4xLTAuNCAyLjktMS4ybDUzLjktNTMuOWMxLjctMS42IDEuNy00LjIgMC4xLTUuOHoiIGZpbGw9IiM2NjY2NjYiLz4KICA8L2c+Cjwvc3ZnPgo=" /></div>',i+='<div class="card-content text-center">',i+='<div class="col-md-8"><span>Cluster Distance</span> 0<input type="range" min="1" max="100" value="50" class="range-slide">100<span class="slide-span"></span></div>',i+="</div>",i+="</div>",i+='<div class="card">',i+='<div class="card-header data"><input type="checkbox">How my data is distributed (skewed) <img src="data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxMjkgMTI5IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAxMjkgMTI5IiB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxNnB4Ij4KICA8Zz4KICAgIDxwYXRoIGQ9Im0xMjEuMywzNC42Yy0xLjYtMS42LTQuMi0xLjYtNS44LDBsLTUxLDUxLjEtNTEuMS01MS4xYy0xLjYtMS42LTQuMi0xLjYtNS44LDAtMS42LDEuNi0xLjYsNC4yIDAsNS44bDUzLjksNTMuOWMwLjgsMC44IDEuOCwxLjIgMi45LDEuMiAxLDAgMi4xLTAuNCAyLjktMS4ybDUzLjktNTMuOWMxLjctMS42IDEuNy00LjIgMC4xLTUuOHoiIGZpbGw9IiM2NjY2NjYiLz4KICA8L2c+Cjwvc3ZnPgo=" /></div>',i+='<div class="card-content text-center">',i+='<div class="col-md-8"><span>Cluster Distance</span> 0<input type="range" min="1" max="100" value="50" class="range-slide">100<span class="slide-span"></span></div>',i+="</div>",i+="</div>",i+='<div class="card">',i+='<div class="card-header vary"><input type="checkbox">Variance <img src="data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxMjkgMTI5IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAxMjkgMTI5IiB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxNnB4Ij4KICA8Zz4KICAgIDxwYXRoIGQ9Im0xMjEuMywzNC42Yy0xLjYtMS42LTQuMi0xLjYtNS44LDBsLTUxLDUxLjEtNTEuMS01MS4xYy0xLjYtMS42LTQuMi0xLjYtNS44LDAtMS42LDEuNi0xLjYsNC4yIDAsNS44bDUzLjksNTMuOWMwLjgsMC44IDEuOCwxLjIgMi45LDEuMiAxLDAgMi4xLTAuNCAyLjktMS4ybDUzLjktNTMuOWMxLjctMS42IDEuNy00LjIgMC4xLTUuOHoiIGZpbGw9IiM2NjY2NjYiLz4KICA8L2c+Cjwvc3ZnPgo=" /></div>',i+='<div class="card-content text-center">',i+='<div class="col-md-8"><span>Cluster Distance</span> 0<input type="range" min="1" max="100" value="50" class="range-slide">100<span class="slide-span"></span></div>',i+="</div>",i+="</div>",i+='<div class="card">',i+='<div class="card-header add"><input type="checkbox">Correlations <img src="data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxMjkgMTI5IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAxMjkgMTI5IiB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxNnB4Ij4KICA8Zz4KICAgIDxwYXRoIGQ9Im0xMjEuMywzNC42Yy0xLjYtMS42LTQuMi0xLjYtNS44LDBsLTUxLDUxLjEtNTEuMS01MS4xYy0xLjYtMS42LTQuMi0xLjYtNS44LDAtMS42LDEuNi0xLjYsNC4yIDAsNS44bDUzLjksNTMuOWMwLjgsMC44IDEuOCwxLjIgMi45LDEuMiAxLDAgMi4xLTAuNCAyLjktMS4ybDUzLjktNTMuOWMxLjctMS42IDEuNy00LjIgMC4xLTUuOHoiIGZpbGw9IiM2NjY2NjYiLz4KICA8L2c+Cjwvc3ZnPgo=" /></div>',i+='<div class="card-content text-center">',i+='<div class="col-md-8"><span>Cluster Distance</span> 0<input type="range" min="1" max="100" value="50" class="range-slide">100<span class="slide-span"></span></div>',i+="</div>",i+="</div>",i+="</div>",i+='<div class="tell-summary" id="tell-summary'+e+'" style="display:none">',i+='<div class="card" id="accordian-summary'+e+'">',i+='<div class="card-header accordian-summary">',i+='<span style="margin:10px"><input type="radio" name="summary'+e+'" id="summary'+e+'"><label for="summary'+e+'"></label> Summary </span>',i+='<span style="margin:10px"><input type="radio" name="summary'+e+'" id="keyInsights'+e+'"><label for="keyInsights'+e+'"></label>Important things </span>',i+='<span style="margin:10px"><input type="radio" name="summary'+e+'" id="everything'+e+'"><label for="everything'+e+'"></label>Tell me everything </span>',i+="</div>",i+='<div class="card-content">',i+='<div class="ootb-text">This option could take slightly longer to generate but will provide the most complete narrative of your data with more verbosity and detail.</div> ',i+="</div>",i+="</div>",i+="</div>",i+="<footer>",i+='<div class="col-md-2"><img class="copyright" src="'+apiEndpoint+'arria/images/copyright.png"><p class="version">Version 2.1</p></div><div class="col-md-10 text-right"><button type="button" class="generate_btn">Generate Text</button></div>',i+="</footer>",i+="</div>",i+='<div class="narrative-tabsection" id="narrative-tabsection'+e+'" style="display:none">',i+='<div class="simple-slide">',i+='<span class="simple" id="simple'+e+'">Simple</span><label class="switch"><input type="checkbox" id="change-ui'+e+'" name="change-ui'+e+'"><span class="slider round"></span></label><span class="advance" id="advance'+e+'">Advanced</span>',i+="</div>",i+='<div id="simple-mode'+e+'" style="display:block;" class="simple-mode">',i+='<div class="container-section">',i+='<div class="description-container">',i+="<p>Call your Arria NLG Studio project to create a narrative from selected data.</p>",i+="</div>",i+='<div class="col-md-12 source-container">',i+="<div>",i+='<input type="text" placeholder="Enter your published NLG Studio project URL" name="url" id="narratorUrl'+e+'">',i+='<input type="text" placeholder="API Key" name="apiUrl" id="authValue'+e+'" >',i+="</div>",i+="</div>",i+='<div class="col-md-12 studio-options">',i+='<div class="col-md-3">',i+="<p>Studio Project Type :</p>",i+="</div>",i+='<div class="col-md-9">',i+='<p><input type="radio" name="simpletype'+e+'" value="table" id="describe-table'+e+'" checked> <label for="describe-table'+e+'">Describe a Table</label></p><p><input type="radio" name="simpletype'+e+'" value="other" id="describe-json'+e+'"> <label for="describe-json'+e+'">Describe a JSON Object</label></p>',i+="</div>",i+="</div>",i+='<div class="col-md-12 edit-mapsection">',i+='<div class="col-md-4 export">',i+='<div class="edit-map" id="custom-script'+e+'">',i+='<div class="col-md-12">',i+='<div class="col-md-12"><img src="'+apiEndpoint+'arria/images/arrow_white.png" id="arrow-script'+e+'"><label>Edit Mapping Script</label></div>',i+="</div>",i+="</div>",i+='<textarea style="display:none;" id="simple-script'+e+'" class="scroll" placeholder="'+(n+="getData()")+'"></textarea>',i+="</div>",i+='<div class="col-md-4 data-json">',i+='<div class="edit-map" id="data-json'+e+'">',i+='<div class="col-md-12">',i+='<div class="col-md-6 title"><img src="'+apiEndpoint+'arria/images/arrow_white.png" id="arrow-json'+e+'" class="arrow"><label>View Dataset in JSON</label></div>',i+='<div class="col-md-6 text-right download-button"> <a style="display:none;" href="javascript:void(0);" id="download-csv'+e+'"><img src="'+apiEndpoint+'arria/images/download_white.png">CSV</a><a style="display:none;" href="javascript:void(0);" id="download-json'+e+'"><img src="'+apiEndpoint+'arria/images/download_white.png">JSON</a></div>',i+="</div>",i+="</div>",i+='<div style="display:none;" class="export-container scroll" id="simple-jsonexport'+e+'" ></div>',i+="</div>",i+='<div class="col-md-4 csvload" id="simple-csv-payload'+e+'" style="display:none;">',i+='<div class="csv-payload edit-map" id="csv-payload'+e+'">',i+='<div class="col-md-12">',i+='<div class="col-md-12"><img src="'+apiEndpoint+'arria/images/arrow_white.png" id="arrow-script'+e+'" class="arrow"><label>View CSV Payload</label></div>',i+="</div>",i+="</div>",i+='<div class="export-container scroll" style="display:none;" id="simple-csvpayload'+e+'" class="scroll"></div>',i+="</div>",i+="</div>",i+='<div class="col-md-12 simple-checkContainer" id="simple-checkContainer'+e+'" style="display:none;">',i+='<input type="checkbox" id="simple-autoincrement'+e+'" checked><label for="simple-autoincrement'+e+'">Add auto increment ID</label>',i+="</div>",i+="</div>",i+="</div>",i+='<div id="advance-mode'+e+'" style="display:none;" class="advance-mode">',i+='<div class="container-section">',i+='<div class="description-container">',i+="<p>Call your NLG service to create a narrative from selected data.</p>",i+="</div>",i+='<div class="col-md-12 source-container">',i+='<input type="text" placeholder="Enter NLG Service URL" name="url" id="narratorUrl_advance'+e+'">',i+='<div class="dynamic-header col-md-12">',i+='<div class="col-md-12 auth-header">',i+='<div class="col-md-4">',i+='<input type="text" placeholder="Key" id="nlg_authKey_0'+e+'" />',i+="</div>",i+='<div class="col-md-8">',i+='<input type="text" placeholder="Value" id="nlg_authValue_0'+e+'"/>',i+="</div>",i+="</div>",i+='<div class="append-container"></div>',i+='<a href="javascript:void(0)" class="addheader-btn"><img src="'+apiEndpoint+'arria/images/add.png">Add Header</a>',i+='<a href="javascript:void(0)" class="removeheader-btn" style="display:none"><b>-</b>Remove Header</a>',i+="</div>",i+="</div>",i+="<div>",i+='<div class="col-md-12 studio-options">',i+='<div class="advance-slide">',i+='<div class="valign-wrapper"><div class="valign"><span class="simple">Studio Project</span><label class="switch"><input type="checkbox" id="studio-toggle'+e+'"  name="studio-toggle'+e+'"><span class="slider round"></span></label></div></div>',i+='<div id="studio-type'+e+'" style="display:none;" class="advance-studio studio-type">',i+='<div class="col-md-3">',i+="<p>Type :</p>",i+="</div>",i+='<div class="col-md-9">',i+='<p><input type="radio" name="advancetype'+e+'" value="other" id="advancedescribe-table'+e+'" checked> <label for="advancedescribe-table'+e+'">Describe a Table</label></p><p><input type="radio" name="advancetype'+e+'" value="other" id="advancedescribe-json'+e+'" checked> <label for="advancedescribe-json'+e+'">Describe a JSON Object</label></p>',i+="</div>",i+="</div>",i+="</div>",i+="</div>",i+='<div class="col-md-12 edit-mapsection">',i+='<div class="col-md-4 export">',i+='<div class="edit-map" id="advancecustom-script'+e+'">',i+='<div class="col-md-12">',i+='<div class="col-md-12"><img src="'+apiEndpoint+'arria/images/arrow_white.png" id="arrow-script'+e+'"><label>Edit Mapping Script</label> </div>',i+="</div>",i+="</div>",i+='<textarea style="display:none;" id="advance-script'+e+'" class="scroll" placeholder="'+n+'"></textarea>',i+="</div>",i+='<div class="col-md-4 data-json">',i+='<div class="edit-map" id="advancedata-json'+e+'">',i+='<div class="col-md-12">',i+='<div class="col-md-6 title"><img src="'+apiEndpoint+'arria/images/arrow_white.png" id="arrow-json'+e+'" class="arrow"><label>View Dataset in JSON</label></div>',i+='<div class="col-md-6 text-right download-button"> <a style="display:none;" href="javascript:void(0);" id="advancedownload-csv'+e+'"><img src="'+apiEndpoint+'arria/images/download_white.png">CSV</a><a style="display:none;" href="javascript:void(0);" id="advancedownload-json'+e+'"><img src="'+apiEndpoint+'arria/images/download_white.png">JSON</a></div>',i+="</div>",i+="</div>",i+='<div style="display:none;" class="export-container scroll" id="advance-jsonexport'+e+'" ></div>',i+="</div>",i+='<div class="col-md-4 csvload" id="advance-csv-payload'+e+'" style="display:none;">',i+='<div class="csv-payload" id="advance-csvpayload'+e+'">',i+='<div class="col-md-12">',i+='<div class="col-md-12"><img src="'+apiEndpoint+'arria/images/arrow_white.png" id="arrow-script'+e+'" class="arrow"><label>View CSV Payload<label></div>',i+="</div>",i+="</div>",i+='<div class="export-container scroll" style="display:none;" id="advance-csvload'+e+'" class="scroll"></div>',i+="</div>",i+="</div>",i+="</div>",i+='<div class="col-md-12 advance-checkContainer" id="advance-checkContainer'+e+'" style="display:none;">',i+='<input type="checkbox" id="advance-autoincrement'+e+'" checked><label for="advance-autoincrement'+e+'">Add auto increment ID</label>',i+="</div>",i+="</div>",i+='<div class="col-md-12 insight-container">',i+='<div class="insight-accordian"><div class="col-md-12"><img src="'+apiEndpoint+'arria/images/arrow_white.png"><label>Insights URL</label></div></div>',i+='<div class="insight-content" style="display:none">',i+="<p>Call insight APIs (Arria or 3rd party) to pre-process data before narrative generation. Leave empty to skip the step.</p>",i+="<hr/>",i+='<input type="text" placeholder="Enter Insights URL" id="insightsURL'+e+'">',i+='<div class="dynamic-header col-md-12">',i+='<div class="col-md-12 auth-header">',i+='<div class="col-md-4">',i+='<input type="text" placeholder="Key" id="insights_authKey_0'+e+'"/>',i+="</div>",i+='<div class="col-md-8">',i+='<input type="text" placeholder="Value" id="insights_authValue_0'+e+'"/>',i+="</div>",i+="</div>",i+='<div class="append-container"></div>',i+='<a href="javascript:void(0)" class="addheader-btn"><img src="'+apiEndpoint+'arria/images/add.png">Add Header</a>',i+='<a href="javascript:void(0)" class="removeheader-btn" style="display:none"><b>-</b>Remove Header</a>',i+="</div>",i+="</div>",i+="</div>",i+='<div class="col-md-12 wrapper-container">',i+='<div class="wrapper-accordian"><div class="col-md-12"> <img src="'+apiEndpoint+'arria/images/arrow_white.png"><label>BI Integration Service URL</label></div></div>',i+='<div class="wrapper-content" style="display:none">',i+="<p>Set your BI integration service URL to override the default public service. Leave blank to use the default public service.</p>",i+="<hr/>",i+='<input type="text" placeholder="Enter BI Integration Service URL"  id="wrapperURL'+e+'">',i+='<div class="dynamic-header col-md-12">',i+='<div class="col-md-12 auth-header">',i+='<div class="col-md-4">',i+='<input type="text" placeholder="Key" id="wrapper_authKey_0'+e+'"/>',i+="</div>",i+='<div class="col-md-8">',i+='<input type="text" placeholder="Value" id="wrapper_authValue_0'+e+'"/>',i+="</div>",i+="</div>",i+='<div class="append-container"></div>',i+='<a href="javascript:void(0)" class="addheader-btn"><img src="'+apiEndpoint+'arria/images/add.png">Add Header</a>',i+='<a href="javascript:void(0)" class="removeheader-btn" style="display:none"><b>-</b>Remove Header</a>',i+="</div>",i+="</div>",i+="</div>",i+="</div>",i+="<footer>",i+='<div class="col-md-2"><img class="copyright" src="'+apiEndpoint+'arria/images/copyright.png"><p class="version">Version 2.1</p></div><div class="col-md-10 text-right"><button type="button" class="openstudio_btn" id="openStudioBtn'+e+'" disabled>Open with Studio</button><button type="button" class="generate_btn"><img style="display:none" src="'+apiEndpoint+'arria/images/loader.gif">Generate Text</button></div>',i+="</footer>",i+="</div>",i+='<div class = "narrative-section" id="narrative-section'+e+'" style="display:none">',i+='<div class="col-md-12 drillDownLayout" id="drillDownLayout'+e+'"><a href="javascript:void(0);" class ="copy-clipboard" id="copy-clipboard'+e+'"><img src="'+apiEndpoint+'arria/images/copy_paste_icon.png"></a><a href="javascript:void(0);" class="back-btn" id="back-btn'+e+'" ><img src="'+apiEndpoint+'arria/images/setting.png"></a></div>',i+='<div class="narrative-container" id="narrative-container'+e+'"></div>',i+='<div id="toast" class="toast" style="display:none;">Copied to Clipboard </div>',i+="</div>",i+="</section>",i+='<textarea id="jsbuilderoutput'+e+'" style="display:none"></textarea>',i+='<div class="hide disable" id="disable'+e+'" style="display:none;"></div>',i+='<div id="pageloader'+e+'" class="spin-loader" style="display:none;"><div class="loader"><div class="ball-scale-multiple"><div></div><div></div><div></div></div></div></div>',i+='<div class="modal" id="modal'+e+'" style="display:none;"><div class="modal-content"><br><br><p id="modaldata'+e+'"></p><br><button type="button" id="closemodal'+e+'">Close</button></div><div class="backdrop"></div></div>',i+="</div>",t.append(i);var l,r='select,.dropdown{background: url("'+apiEndpoint+'arria/images/arrow_downblack.png") no-repeat right #fff;} ';$("<style>").html(r).appendTo("head"),void 0!=$("body").find("div[tid="+e.split("_")[1]+"]").height()&&(l=parseInt($("body").find("div[tid="+e.split("_")[1]+"]").height())-60);var d=$("#qlikContainer"+e).width();d=parseInt(d),void 0!=l&&NaN!=l&&($("#qlikContainer"+e).css({height:l+"px"}),$("#narrative-section"+e).css({height:l+"px"}));var o="qlikContainer"+e;if(d<=840){r="";r+=(c="#qlikContainer"+e+" ")+".outofbox-tabsection .entity-selction p:first-child{text-align:left;margin-left:0px;}",$("<style id=responsive-840"+o+">").html(r).appendTo("head")}if(d<=765&&d>=641){var s="";s+=(c="#qlikContainer"+e+" ")+".measure-list span { display: block; text-align: center; margin-bottom: 8px; }",s+=c+".variance .col-md-4 label{display:block; margin-bottom: 8px;}",$("<style id=responsive-765"+o+">").html(s).appendTo("head")}if(d<=760){s="";s+=(c="#qlikContainer"+e+" ")+".narrative-tabsection .auth-header .col-md-8, .narrative-tabsection .auth-header .col-md-4 { width: 100%; padding-right: 0px; padding-left: 0px; }",$("<style id=responsive-760"+o+">").html(s).appendTo("head")}if(d<=640){var c;s="";s+=(c="#qlikContainer"+e+" ")+".outofbox-tabsection .entity-selction p{margin-left:0px!important}",s+=c+".card-field .col-md-6{text-align:left!important}",s+=c+".tell-data .card-content .col-md-12:first-child .col-md-6,"+c+".tell-data .card-content .col-md-12:first-child .col-md-6 p{margin-bottom:0px!important}",s+=c+".tell-data .card-content .col-md-6{width:100%!important;text-align:left!important}",s+=c+".measure-list .col-md-4{width:100%!important}",s+=c+".tell-data .card-content .col-md-12:first-child .col-md-6 p:last-child{margin-left:15%}",s+=c+".measure-list{margin-top:20px}",s+=c+".col-md-12.measure-list.text-center{text-align:left!important}",s+=c+".measure-list .col-md-4 select{width:62%!important}",s+=c+".measure-list .col-md-4 input{width:60%}",s+=c+".measure-list .col-md-4 span{width:30%;display:inline-block}",s+=c+".tell-what .col-md-6{width:100%!important}",s+=c+".outofbox-tabsection .stats .card-content .col-md-6:first-child{text-align:left!important}",s+=c+".targetbasedvariance .col-md-4 label{width:30%;display:inline-block}",s+=c+".targetbasedvariance .col-md-4{width:100%!important}",s+=c+".targetbasedvariance .col-md-4:nth-child(2) select{width:60%!important;margin-left:10px!important}",s+=c+".entity-selction p{width:100%!important}",s+=c+".timebasedvariance .col-md-4{width:100%!important}",s+=c+".variance .col-md-4 label{width:30%;display:inline-block}",s+=c+".multiple-range.col-md-8,"+c+" .correlations .col-md-8{width:100%!important}",s+=c+".studio-options .col-md-3,"+c+" .studio-options .col-md-9{display:block;width:100%!important}",s+=c+".studio-options .col-md-9 p:first-child{margin:0!important}",s+=c+".studio-options .col-md-9 p{display:block!important;margin:10px 0px !important;}",s+=c+".edit-mapsection{display:inline-block!important}",s+=c+".export,"+c+" .data-json,"+c+" .csvload{width:100%!important;margin-bottom:10px}",s+=c+".edit-mapsection .export,"+c+" .edit-mapsection .data-json{float:none!important}",s+=c+"footer{text-align:center;position:relative;min-height:100px;margin-bottom:10px}",s+=c+"footer .col-md-2{width:100%!important;text-align:center;position:absolute;bottom:0;right:0;left:0}",s+=c+"footer .col-md-10.text-right{text-align:center!important;width:100%!important}",s+=c+".dynamic-header .auth-header .col-md-4{padding-right:0}",s+=c+".dynamic-header .col-md-4,"+c+" .dynamic-header .col-md-8{width:100%!important}",s+=c+".studio-type{width:100%!important;position:relative;margin-top:15px;float:none}",s+=c+".studio-type .col-md-3{width:15%!important;float:left;text-align:right;margin-top:10px}",s+=c+".studio-type .col-md-9{width:69%!important;float:left;padding-left:25px}",s+=c+".studio-type .col-md-9 p{margin-bottom:10px!important}",s+="#simple-mode"+e+" .studio-options .col-md-3 p{margin-bottom:16px;}",s+=c+".edit-mapsection{padding-bottom: 0px;}",s+=c+".measure-list span{text-align:left;}",s+=c+".measure-list.text-left{text-align:left;}",s+=c+"div.distribution:last-child { display: block; margin-left: 52px !important; }",s+=c+".timebasedvariance, "+c+".targetbasedvariance{text-align:left !important;}",s+=c+".outofbox-tabsection .variance .col-md-4 select{width: 60%;padding: 5px;height:auto;}",s+=c+".outofbox-tabsection .entity-selction p:first-child{text-align:left;}",s+=c+".outofbox-tabsection .correlations .card-content .col-md-8:first-child p { float: none; display: block; text-align: left; }",s+=c+".outofbox-tabsection .correlations .card-content .col-md-8:first-child .measure-container{text-align:left;display: block;}",s+=c+".card .card-content .measure-list.text-center select{margin-left:12px !important}",s+=c+".multiple-range label { margin-top: 40px; }",$("<style id=responsive-640"+o+">").html(s).appendTo("head")}if(d<=540){r="";r+=c+".tell-data .card-content .col-md-12:first-child .col-md-6 p:last-child{margin-left:10%}",r+=c+"#correlations"+e+" .multiple-range label {margin-top: 40px;}",$("<style id=responsive-540"+o+">").html(r).appendTo("head")}if(d<=500){r="";r+=c+".multiple-range label{margin-top:40px}",r+=c+".accordian-summary span { display: block; text-align: left; }",$("<style id=responsive-500"+o+">").html(r).appendTo("head")}if(d<=460){r="";r+=c+".outofbox-tabsection .distribution-container .distribution:first-child p:last-child { margin-left: 62px; }",r+=c+".multiple-range label,"+c+".multiple-range label input{width: 320px !important;}",r+=c+".increase-container span { display: block; margin-bottom: 15px; }"+c+".tell-data .card-content .col-md-6:last-child p { display: block; float: left; }"+c+".card-content .col-md-6:last-child p.good-container { margin-left: 0px !important; }",r+=c+".tab-header button { margin-top: 30px; }",r+=c+".tab-header a{top:initial;transform: translateY(-0%);}",$("<style id=responsive-460"+o+">").html(r).appendTo("head")}if(d<=420){r="";r+=c+".studio-type .col-md-9{width:60%!important}"+c+".studio-type .col-md-3{width:24 %!important}",r+=c+".multiple-range label,"+c+" .multiple-range label input{width: 260px !important;}",$("<style id=responsive-420"+o+">").html(r).appendTo("head")}if(d<=400){r="";r+=c+"header .tab-header button{padding: 8px 2px !important;font-size:12px !important;}",$("<style id=responsive-400"+o+">").html(r).appendTo("head")}if(d<=340){r="";r+=c+".openstudio_btn{margin: 7px 5px 10px 0px;padding: 4px 10px;font-size: 12px;}",r+=c+".generate_btn{margin: 7px 0;padding: 4px 10px; font-size: 12px;}",$("<style id=responsive-340"+o+">").html(r).appendTo("head")}}return getEntitiesForOOTB(),getFingerPrintKey(),{initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:10,qHeight:1e3}]}},definition:{type:"items",component:"accordion",items:{dimensions:{uses:"dimensions",min:1},measures:{uses:"measures",min:1},appearancePanel:{uses:"settings",items:{url:{ref:"url",type:"string",label:"Url",defaultValue:"",show:!1},auth:{ref:"headerKey",type:"string",label:"Header Key",defaultValue:"",show:!1},key:{ref:"authKey",type:"string",label:"Auth Key",defaultValue:"",show:!1},state:{ref:"state",type:"text",label:"Narrator State",defaultValue:"",show:!1},narrator:{ref:"narrator",type:"string",label:"Narrator Text",defaultValue:"",show:!1},script:{ref:"script",type:"string",label:"Script",defaultValue:"",show:!1},drillDown0:{type:"items",label:"Drill down filter 1",items:{drillDownFilterKey0:{ref:"drillDownFilterKey0",type:"string",label:"Key",defaultValue:"",show:!0},drillDownFilterLbl0:{ref:"drillDownFilterLbl0",type:"string",label:"Label",defaultValue:"",show:!0},drillDownFilterVal0:{ref:"drillDownFilterVal0",type:"string",label:"Drill Down Fields",defaultValue:"",show:!0}}},drillDown1:{type:"items",label:"Drill down filter 2",items:{drillDownFilterKey1:{ref:"drillDownFilterKey1",type:"string",label:"Key",defaultValue:"",show:!0},drillDownFilterLbl1:{ref:"drillDownFilterLbl1",type:"string",label:"Label",defaultValue:"",show:!0},drillDownFilterVal1:{ref:"drillDownFilterVal1",type:"string",label:"Drill Down Fields",defaultValue:"",show:!0}}},drillDown2:{type:"items",label:"Drill down filter 3",items:{drillDownFilterKey2:{ref:"drillDownFilterKey2",type:"string",label:"Key",defaultValue:"",show:!0},drillDownFilterLbl2:{ref:"drillDownFilterLbl2",type:"string",label:"Label",defaultValue:"",show:!0},drillDownFilterVal2:{ref:"drillDownFilterVal2",type:"string",label:"Drill Down Fields",defaultValue:"",show:!0}}},drillDown3:{type:"items",label:"Drill down filter 4",items:{drillDownFilterKey3:{ref:"drillDownFilterKey3",type:"string",label:"Key",defaultValue:"",show:!0},drillDownFilterLbl3:{ref:"drillDownFilterLbl3",type:"string",label:"Label",defaultValue:"",show:!0},drillDownFilterVal3:{ref:"drillDownFilterVal3",type:"string",label:"Drill Down Fields",defaultValue:"",show:!0}}},fontSize:{type:"items",label:"Formatting Options",items:{narrativeFontSize:{ref:"narrativeFontSize",type:"number",component:"slider",min:10,max:36,step:1,defaultValue:13,label:"Text Size (10px - 36px)",show:!0}}},drillDownValue:{ref:"drillDownValue",type:"string",label:"Drill Down",defaultValue:"",show:!1}}}}},support:{export:!0},paint:function($element,layout){var _this=this;let describeTbl=!1,targetElement="generatorView",targetView="ootb",csvData="",csv_columnData=[],csv_rowData=[];var dataModel={};let presistData={},nlgHeaderDynamicElCount=0,insightsHeaderDynamicElCount=0,wrapperHeaderDynamicElCount=0,insights_service_headers={},wrapper_service_headers={},nlg_service_headers={};var studioProjectEnabledFlg=!1;let drillDownFilterCount=4,measureColumn=[],dimensionCharacterization=[];var ootbColumns=[],analysisArray="",ootbModel={narrativeConfigMetaData:{characterization:"",analysisOrchestration:"",generation:""}};let generateBtnClicked=!1;var analysisMetadata,presistOOTBLoad=!1,measureFields=[],fontSize=layout.narrativeFontSize;(fontSize<10||fontSize>36)&&(layout.narrativeFontSize=13,fontSize=13);var hypercube=layout.qHyperCube,columnsArr=[],rowsArr=[],measuresList=[],dataPages=[],columns=hypercube.qSize.qcx,totalRowCount=hypercube.qSize.qcy,pageRowCount=Math.floor(1e4/columns),initialRow=0;function getDataSet(chartId){var requestPage=[{qTop:0,qLeft:0,qWidth:columns,qHeight:Math.min(pageRowCount,totalRowCount-initialRow)}];_this.backendApi.getData(requestPage).then(function(dataSets){if(dataPages=dataPages.concat(dataSets[0].qMatrix),initialRow+=dataSets[0].qMatrix.length,initialRow<totalRowCount&&initialRow<=3e4)getDataSet(chartId);else{try{dataPages.forEach(function(e,t){for(var a=[],n=0;n<e.length;n++){var i="";void 0!=e[n].qText&&"-"==(i=e[n].qText)&&(i=null),a.push(i)}rowsArr.push(a);let l=[];(l=l.concat(a)).splice(0,0,t+1),csv_rowData.push(l)})}catch(e){console.log(e)}dataModel._id="1",dataModel.version="2.1.0",dataModel.chartType="table",dataModel.source="qliksense",dataModel.targetApp="",dataModel.nlgApp="",dataModel.dataset=[];var colObj={metadata:{},drillDowns:[]};colObj.measures=measuresList,colObj.column_names=columnsArr,colObj.data=rowsArr,dataModel.dataset.push(colObj);var chartInfo=chartId;let stringifiedRow=JSON.stringify(rowsArr);void 0==selColstrack[chartInfo]&&(selColstrack[chartInfo]=""),stringifiedRow!=selColstrack[chartInfo]?(debounce=!0,selColstrack[chartInfo]=stringifiedRow,presistOOTBLoad=!1):(presistOOTBLoad=!0,debounce=!1);let csvArr_Data=[];csvArr_Data=csvArr_Data.concat(csv_rowData),csvArr_Data.splice(0,0,csv_columnData),csvData=convertToCSV(csvArr_Data);for(var i=0;i<columnsArr.length;i++){var exitKey=ootbColumns.some(function(e){return e.name===columnsArr[i]});if(!exitKey){ootbColumns.push({name:columnsArr[i],measure:!1});for(var measureIndex=0;measureIndex<measuresList.length;measureIndex++)-1!=measuresList[measureIndex].indexOf(columnsArr[i])&&(ootbColumns[ootbColumns.length-1].measure=!0)}}_this.backendApi.getProperties().then(function(res){var chartId="_"+res.qInfo.qId,chartObj=res;0==$("#qlikContainer"+chartId).length&&(_this["columns"+chartId]=[],_this.initializeOOTBMetadata=!0,createNarrativeUI(chartId,$element,chartObj));let containerElement=document.getElementById("qlikContainer"+chartId),documentBtn=document.getElementById("documentBtn"+chartId),tabBoxElement=document.getElementById("box-tab"+chartId),tabNarrativeElement=document.getElementById("narrative-tab"+chartId),outofTabElement=document.getElementById("outofbox-tabsection"+chartId),narrativeTabElement=document.getElementById("narrative-tabsection"+chartId),datasetJsonElement=document.getElementById("data-json"+chartId),customScriptElement=document.getElementById("custom-script"+chartId),scriptInputSimpleElement=document.getElementById("simple-script"+chartId),customScriptAppendElement=document.getElementById("jsbuilderoutput"+chartId),simpleExport=document.getElementById("simple-jsonexport"+chartId),simpleTableBtn=document.getElementById("describe-table"+chartId),simpleExportBtn=document.getElementById("describe-json"+chartId),downloadJsonBtn=document.getElementById("download-json"+chartId),downloadCsvBtn=document.getElementById("download-csv"+chartId),checkSliderBtn=document.getElementById("change-ui"+chartId),simpleUiContainer=document.getElementById("simple-mode"+chartId),advanceUiContainer=document.getElementById("advance-mode"+chartId),simpleText=document.getElementById("simple"+chartId),advanceText=document.getElementById("advance"+chartId),narrativeSection=document.getElementById("narrative-section"+chartId),narrativeContainer=document.getElementById("narrative-container"+chartId),cogWheel=document.getElementById("back-btn"+chartId),generateSimpleNarrative=document.querySelector("#narrative-tabsection"+chartId+" .generate_btn"),narratorUrl=document.getElementById("narratorUrl"+chartId),narratorUrl_advance=document.getElementById("narratorUrl_advance"+chartId),openStudioBtn=document.getElementById("openStudioBtn"+chartId),authValueElement=document.getElementById("authValue"+chartId),closeModalBtn=document.getElementById("closemodal"+chartId),simpleCSVPayloadDiv=document.getElementById("simple-csv-payload"+chartId),simpleCSVPayload=document.getElementById("csv-payload"+chartId),simpleCSVContainer=document.getElementById("simple-csvpayload"+chartId),insightAccordianBtn=document.querySelector("#advance-mode"+chartId+" .insight-accordian"),insightAccordian=document.querySelector("#advance-mode"+chartId+" .insight-content"),wrapperAccordianBtn=document.querySelector("#advance-mode"+chartId+" .wrapper-accordian"),wrapperAccordian=document.querySelector("#advance-mode"+chartId+" .wrapper-content"),addDynamicHeaderBtn=document.querySelector("#advance-mode"+chartId+" .source-container .addheader-btn"),addInsightHeaderBtn=document.querySelector("#advance-mode"+chartId+" .insight-container .addheader-btn"),addWrapperHeaderBtn=document.querySelector("#advance-mode"+chartId+" .wrapper-container .addheader-btn"),advanceTableBtn=document.getElementById("advancedescribe-table"+chartId),advanceExportBtn=document.getElementById("advancedescribe-json"+chartId),advancedownloadJsonBtn=document.getElementById("advancedownload-json"+chartId),advancedownloadCsvBtn=document.getElementById("advancedownload-csv"+chartId),advanceDatasetJsonElement=document.getElementById("advancedata-json"+chartId),advanceCustomScriptElement=document.getElementById("advancecustom-script"+chartId),advanceScriptInputSimpleElement=document.getElementById("advance-script"+chartId),advanceExport=document.getElementById("advance-jsonexport"+chartId),removeDynamicHeaderBtn=document.querySelector("#advance-mode"+chartId+" .source-container .removeheader-btn"),removeInsightHeaderBtn=document.querySelector("#advance-mode"+chartId+" .insight-container .removeheader-btn"),removeWrapperHeaderBtn=document.querySelector("#advance-mode"+chartId+" .wrapper-container .removeheader-btn"),spinner=document.querySelector("#narrative-tabsection"+chartId+" .generate_btn img"),insightsURL=document.getElementById("insightsURL"+chartId),wrapperURL=document.getElementById("wrapperURL"+chartId),headerSection=document.getElementById("header"+chartId),pageloader=document.getElementById("pageloader"+chartId),drillDownLayout=document.getElementById("drillDownLayout"+chartId),advanceCSVPayloadDiv=document.getElementById("advance-csv-payload"+chartId),advanceCSVPayload=document.getElementById("advance-csvpayload"+chartId),advanceCSVContainer=document.getElementById("advance-csvload"+chartId),tellmedataContainer=document.getElementById("tell-data"+chartId),prevoiusBtn=document.querySelector("#outofbox-tabsection"+chartId+" .previous"),nextBtn=document.querySelector("#outofbox-tabsection"+chartId+" .next"),tellWhatContainer=document.getElementById("tell-what"+chartId),tellSummaryContainer=document.getElementById("tell-summary"+chartId),sliderContent=document.querySelector("#outofbox-tabsection"+chartId+" .header p"),slideDotOne=document.getElementById("slide1"+chartId),slideDotTwo=document.getElementById("slide2"+chartId),slideDotThree=document.getElementById("slide3"+chartId),rangeSlideElement=document.getElementsByClassName("range-slide"),slideSpan=document.getElementsByClassName("slide-span"),ootb_generateBtn=document.querySelector("#outofbox-tabsection"+chartId+" button.generate_btn"),advance_studio_toggle=document.getElementById("studio-toggle"+chartId),advance_studio_type=document.getElementById("studio-type"+chartId),summaryCheckBtn=document.getElementById("summary"+chartId),keyInsightsCheckBtn=document.getElementById("keyInsights"+chartId),everythingCheckBtn=document.getElementById("everything"+chartId),simpleCheckboxContainer=document.getElementById("simple-checkContainer"+chartId),simpleIncrementBtn=document.getElementById("simple-autoincrement"+chartId),advanceCheckboxContainer=document.getElementById("advance-checkContainer"+chartId),advanceIncrementBtn=document.getElementById("advance-autoincrement"+chartId),disableContainer=document.getElementById("disable"+chartId),copyClipboardBtn=document.getElementById("copy-clipboard"+chartId);var elementHeight=parseInt($(".qv-gridcell.active").height())-60;void 0!==elementHeight&&NaN!=elementHeight&&$("#qlikContainer"+chartId).css({height:elementHeight+"px"}),void 0===_this["callNarration"+chartId]&&(_this["callNarration"+chartId]=!1),narrativeContainer.style.fontSize=fontSize+"px";var currentMode=qlik.navigation.getMode();cogWheel.style.display="analysis"===currentMode?"none":"block",initialViewVisibility(),disableEditMode();let drillDownUserData=getDrillDownUserInputData(layout)||{},drillDownDataKeys=Object.keys(drillDownUserData);var drillDownCount=drillDownDataKeys.length,drillDownWidth=100/drillDownCount;if(fetchDrillDownData(layout),setPresistedDataToDD(),setPresistedData_View(),debounce)try{dynamicColumn()}catch(e){console.log(e)}function dynamicColumn(){var e=[];if(unSelectCoumn(),void 0!=presistData.columns&&0==_this["columns"+chartId].length&&"[]"!=presistData.columns&&(_this["columns"+chartId]=JSON.parse(presistData.columns),window.sessionStorage.setItem("columns"+chartId,presistData.columns),presistData.columns=void 0),0!=_this["columns"+chartId].length){e=_this["columns"+chartId];for(var t=0;t<ootbColumns.length;t++){e.some(function(e){return e.name==ootbColumns[t].name})||e.push(ootbColumns[t])}}else(null!=window.sessionStorage.getItem("columns"+chartId)||void 0!=window.sessionStorage.getItem("columns"+chartId)&&"[]"!=window.sessionStorage.getItem("columns"+chartId))&&"[]"!=window.sessionStorage.getItem("columns"+chartId)?(_this["columns"+chartId]=JSON.parse(window.sessionStorage.getItem("columns"+chartId)),e=_this["columns"+chartId]):e=ootbColumns;_this["columns"+chartId]=e;for(let t=0;t<e.length;t++){let a=e[t].name,n=e[t].name.replace(/\s/g,"");n+=chartId;let i=document.getElementById(n);if(null==i||void 0==i){let i=document.createElement("div");i.setAttribute("class","card active"),i.setAttribute("id",n),i.setAttribute("data-id",t),i.setAttribute("draggable","true"),i.setAttribute("data-attr",e[t].name);let l="",r="",d="",o="";e[t].measure?(d+='<div class="col-md-12 text-center" id="dimension-wrapper'+t+chartId+'">',d+='<div class="col-md-6 text-center dimension-section"><p><input type="radio" name="dimension'+t+chartId+'" id="dimension'+t+chartId+'" data-input='+t+'> <label for="dimension'+t+chartId+'">Dimension</label></p><p><input type="radio" name="measure'+t+chartId+'" id="measure'+t+chartId+'" data-input='+t+'> <label for="measure'+t+chartId+'">Measure</label></p></div>',d+="</div>",r+='<div class="col-md-4"><span>Alias</span> <input type="text" name="alias'+t+chartId+'" placeholder="US"/></div><div class="col-md-4" id="entitycontainer'+t+chartId+'" style="display:inline-block"><span>Entity Type</span> </div><div class="col-md-4" id="measure-container'+t+chartId+'" style="display:inline-block"><span>Unit</span> <input type="text" name="unit'+t+chartId+'" placeholder="USD"/></div>',o+='<div class="col-md-6 increase-container text-center" id="increase-container'+t+chartId+'" style="display:inline-block;"><span>Increase in Value is:</span><p class="good-container"><input type="radio" name="measure-selection'+t+chartId+'" id="good'+t+chartId+'" checked> <label for="good'+t+chartId+'">Good</label></p><p class="neutral-container"><input type="radio" name="measure-selection'+t+chartId+'" id="neutral'+t+chartId+'"> <label for="neutral'+t+chartId+'">Neutral</label></p><p class="bad-container"><input type="radio" name="measure-selection'+t+chartId+'" id="bad'+t+chartId+'"> <label for="bad'+t+chartId+'">Bad</label></p></div>'):(d+='<div class="col-md-12 text-center" id="dimension-wrapper'+t+chartId+'">',d+='<div class="col-md-6 text-center dimension-section" style="width:100%;"><p><input type="radio" name="dimension'+t+chartId+'" id="dimension'+t+chartId+'" data-input='+t+'> <label for="dimension'+t+chartId+'">Dimension</label></p><p><input type="radio" name="measure'+t+chartId+'" id="measure'+t+chartId+'" data-input='+t+'> <label for="measure'+t+chartId+'">Measure</label></p></div>',d+="</div>",r+='<div class="col-md-4"><span>Alias</span> <input type="text" name="alias'+t+chartId+'" placeholder="US"/></div><div class="col-md-4"  id="entitycontainer'+t+chartId+'" style="display:inline-block"><span>Entity Type</span></div><div class="col-md-4" id="measure-container'+t+chartId+'" style="display:none"><span>Unit</span> <input type="text" name="unit'+t+chartId+'" placeholder="USD"/></div>',o+='<div class="col-md-6 increase-container text-center" id="increase-container'+t+chartId+'" style="display:none"><span>Increase in Value is:</span><p class="good-container"><input type="radio" name="measure-selection'+t+chartId+'" id="good'+t+chartId+'" checked> <label for="good'+t+chartId+'">Good</label></p><p class="neutral-container"><input type="radio" name="measure-selection'+t+chartId+'" id="neutral'+t+chartId+'"> <label for="neutral'+t+chartId+'">Neutral</label></p><p class="bad-container"><input type="radio" name="measure-selection'+t+chartId+'" id="bad'+t+chartId+'"> <label for="bad'+t+chartId+'">Bad</label></p></div>'),l+='<div class="card-header '+n+'" id="header'+n+'"><div class="drag-holder" style="background-image:url('+apiEndpoint+'arria/images/drag.png)"></div>'+a+' <img class="card-toggle '+n+'" src="data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCIgdmlld0JveD0iMCAwIDI4NC45MjkgMjg0LjkyOSIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMjg0LjkyOSAyODQuOTI5OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxnPgoJPHBhdGggZD0iTTI4Mi4wODIsNzYuNTExbC0xNC4yNzQtMTQuMjczYy0xLjkwMi0xLjkwNi00LjA5My0yLjg1Ni02LjU3LTIuODU2Yy0yLjQ3MSwwLTQuNjYxLDAuOTUtNi41NjMsMi44NTZMMTQyLjQ2NiwxNzQuNDQxICAgTDMwLjI2Miw2Mi4yNDFjLTEuOTAzLTEuOTA2LTQuMDkzLTIuODU2LTYuNTY3LTIuODU2Yy0yLjQ3NSwwLTQuNjY1LDAuOTUtNi41NjcsMi44NTZMMi44NTYsNzYuNTE1QzAuOTUsNzguNDE3LDAsODAuNjA3LDAsODMuMDgyICAgYzAsMi40NzMsMC45NTMsNC42NjMsMi44NTYsNi41NjVsMTMzLjA0MywxMzMuMDQ2YzEuOTAyLDEuOTAzLDQuMDkzLDIuODU0LDYuNTY3LDIuODU0czQuNjYxLTAuOTUxLDYuNTYyLTIuODU0TDI4Mi4wODIsODkuNjQ3ICAgYzEuOTAyLTEuOTAzLDIuODQ3LTQuMDkzLDIuODQ3LTYuNTY1QzI4NC45MjksODAuNjA3LDI4My45ODQsNzguNDE3LDI4Mi4wODIsNzYuNTExeiIgZmlsbD0iIzk4OTg5OCIvPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+Cjwvc3ZnPgo="/></div>',l+='<div class="card-content" id="content'+t+chartId+'">',l+=d,l+='<div class="col-md-12 measure-list">',l+=r,l+="</div>",l+=o,l+="</div>",i.innerHTML=l,tellmedataContainer.appendChild(i),document.querySelector('input[name="alias'+t+chartId+'"').value=a;let s=document.getElementById("dimension"+t+chartId);s.addEventListener("change",dimensionEvent);let c=document.getElementById("measure"+t+chartId);c.addEventListener("change",measureEvent);let m=document.getElementsByClassName("measure-list");if(e[t].measure?(c.checked=!0,m[t].classList.add("text-left")):(s.checked=!0,m[t].classList.add("text-center")),null==document.getElementById("select-entity"+t+chartId)||void 0==document.getElementById("select-entity"+t+chartId)){let a=document.createElement("select");a.setAttribute("name","entity"+t+chartId),a.setAttribute("id","select-entity"+t+chartId),document.getElementById("entitycontainer"+t+chartId).appendChild(a);let n=document.createElement("option");n.text="Select",n.value="",n.selected=!0,document.getElementById("select-entity"+t+chartId).appendChild(n);let i=[];if((i=e[t].measure?measureEntityType:entityType).entityTypes.length>0)for(let e=0;e<i.entityTypes.length;e++){let a=document.createElement("option");a.text=i.entityTypes[e],a.value=i.entityTypes[e],document.getElementById("select-entity"+t+chartId).appendChild(a)}else e.length-1==t&&callEntityTypes()}let u=document.getElementById("nondraggable"+chartId);if(null==u&&void 0==u||u.parentNode.removeChild(u),e.length-1==t){let e=document.createElement("div");e.setAttribute("id","nondraggable"+chartId),e.setAttribute("draggable","true"),e.setAttribute("class","card nondraggable"),e.setAttribute("data-attr","nondraggable"),tellmedataContainer.appendChild(e)}}else if(!presistOOTBLoad){let a=i.getAttribute("data-attr"),n=i.getAttribute("data-id");if(a==e[t].name&&t!=parseInt(n)){let e=document.getElementById("content"+n+chartId);i.setAttribute("data-id",t),e.setAttribute("id","content"+t+chartId),document.getElementById("dimension-wrapper"+n+chartId).setAttribute("id","dimension-wrapper"+t+chartId);let a=document.getElementById("dimension"+n+chartId);a.setAttribute("id","dimension"+t+chartId),a.setAttribute("name","dimension"+t+chartId),a.setAttribute("data-input",t),document.querySelector('label[for="dimension'+n+chartId+'"').setAttribute("for","dimension"+t+chartId);let l=document.getElementById("measure"+n+chartId);l.setAttribute("id","measure"+t+chartId),l.setAttribute("name","measure"+t+chartId),l.setAttribute("data-input",t),document.querySelector('label[for="measure'+n+chartId+'"').setAttribute("for","measure"+t+chartId);let r=document.getElementById("good"+n+chartId);r.setAttribute("id","good"+t+chartId),r.setAttribute("name","measure-selection"+t+chartId),document.querySelector('label[for="good'+n+chartId+'"').setAttribute("for","good"+t+chartId);let d=document.getElementById("bad"+n+chartId);d.setAttribute("id","bad"+t+chartId),d.setAttribute("name","measure-selection"+t+chartId),document.querySelector('label[for="bad'+n+chartId+'"').setAttribute("for","bad"+t+chartId);let o=document.getElementById("neutral"+n+chartId);o.setAttribute("id","bad"+t+chartId),o.setAttribute("name","measure-selection"+t+chartId),document.querySelector('label[for="neutral'+n+chartId+'"').setAttribute("for","neutral"+t+chartId),document.querySelector('input[name="alias'+n+chartId+'"').setAttribute("name","alias"+t+chartId),document.getElementById("entitycontainer"+n+chartId).setAttribute("id","entitycontainer"+t+chartId);let s=document.getElementById("select-entity"+n+chartId);s.setAttribute("id","select-entity"+t+chartId),s.setAttribute("name","entity"+t+chartId),document.getElementById("measure-container"+n+chartId).setAttribute("id","measure-container"+t+chartId),document.querySelector('input[name="unit'+n+chartId+'"').setAttribute("name","unit"+t+chartId),document.getElementById("increase-container"+n+chartId).setAttribute("id","increase-container"+t+chartId)}}}var a=document.querySelectorAll("#tell-data"+chartId+"  .card");[].forEach.call(a,addDragEventHalders)}function callEntityTypes(){if(0==entityType.entityTypes.length){pageloader.style.display="block";let e=new XMLHttpRequest;e.onreadystatechange=function(){4===this.readyState&&200===this.status&&""!=e.responseText&&(entityType=JSON.parse(e.responseText),pageloader.style.display="none",setEntityValues())},e.onerror=function(e){pageloader.style.display="none",window.navigator.onLine?showModal(e,chartId):showModal("You are offline. Please check that you are connected to the Internet",chartId),pageloader.style.display="none"},e.open("GET",OOTBEndPoint+"ootb/entitytypesfordims"),e.setRequestHeader("x-api-key",OOTBEndPointKey),window.navigator.onLine?e.send():showModal("You are offline. Please check that you are connected to the Internet",chartId)}if(0===measureEntityType.entityTypes.length){pageloader.style.display="block";let e=new XMLHttpRequest;e.onreadystatechange=function(){4===this.readyState&&200===this.status&&""!==e.responseText&&(measureEntityType=JSON.parse(e.responseText),pageloader.style.display="none",setEntityValues())},e.onerror=function(e){window.navigator.onLine?showModal(e,chartId):showModal("You are offline. Please check that you are connected to the Internet",chartId),pageloader.style.display="none"},e.open("GET",OOTBEndPoint+"ootb/entitytypesformeasures"),e.setRequestHeader("x-api-key",OOTBEndPointKey),window.navigator.onLine?e.send():showModal("You are offline. Please check that you are connected to the Internet",chartId)}}function setEntityValues(){let e=document.querySelectorAll("#tell-data"+chartId+"  .card"),t=0;for(let a=0;a<e.length-1;a++){let n=e[a].getAttribute("data-id"),i=document.getElementById("select-entity"+n+chartId),l=[];if(document.getElementById("dimension"+n+chartId).checked?(l=entityType,t=entityType.entityTypes.length):(l=measureEntityType,t=measureEntityType.entityTypes.length),null!==i&&i.options.length!==t+1)for(let e=0;e<t;e++){let t=document.createElement("option");t.text=l.entityTypes[e],t.value=l.entityTypes[e],i.appendChild(t)}}initializeOOTB()}function addDragEventHalders(e){e.addEventListener("dragstart",dimensioHandleDragStart,!1),e.addEventListener("dragenter",dimensionHandleDragEnter,!1),e.addEventListener("dragover",dimensionHandleDragOver,!1),e.addEventListener("dragleave",dimensionHandleDragLeave,!1),e.addEventListener("drop",dimensionHandleDrop,!1),e.addEventListener("dragend",dimensionHandleDragEnd,!1)}function dimensioHandleDragStart(e){dragSrcEl=this,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",this.outerHTML),this.classList.add("dragElem")}function dimensionHandleDragOver(e){return e.preventDefault&&e.preventDefault(),this.classList.add("over"),e.dataTransfer.dropEffect="move",!1}function dimensionHandleDragEnter(e){}function dimensionHandleDragLeave(e){this.classList.remove("over")}function dimensionHandleDrop(e){e.stopPropagation&&e.stopPropagation();try{if(null!==dragSrcEl&&dragSrcEl!==this){let a=dragSrcEl.getAttribute("data-id"),n=document.querySelector('input[name="alias'+a+chartId+'"]');n=n.value;let i=document.getElementById("select-entity"+a+chartId);i=i.value;let l=!0,r=null,d="";if(document.getElementById("measure"+a+chartId).checked){l=!1,d=document.querySelector('input[name="unit'+a+chartId+'"]').value;let e=document.getElementById("good"+a+chartId),t=document.getElementById("neutral"+a+chartId);r=e.checked?"good":t.checked?"neutral":"bad"}dragValue(l,n,i,d,r,a),this.parentNode.removeChild(dragSrcEl);var t=e.dataTransfer.getData("text/html");this.insertAdjacentHTML("beforebegin",t),addDragEventHalders(this.previousSibling)}}catch(e){console.log(e)}return this.classList.remove("over"),!1}function dimensionHandleDragEnd(e){this.classList.remove("over")}function dragValue(e,t,a,n,i,l){setTimeout(function(){try{let r=document.querySelector('input[name="alias'+l+chartId+'"]'),d=document.getElementById("dimension"+l+chartId),o=document.getElementById("measure"+l+chartId),s=document.getElementById("select-entity"+l+chartId);if(""!==t&&null!==r&&(r.value=t),e?null!==d&&(d.checked=!0):null!==o&&(o.checked=!0),""!==a&&null!==s&&(s.value=a),""!==n){let e=document.querySelector('input[name="unit'+l+chartId+'"]');null!==e&&(e.value=n)}if(null!==i){let e=document.getElementById("good"+l+chartId),t=document.getElementById("bad"+l+chartId),a=document.getElementById("neutral"+l+chartId);"good"===i?e.checked=!0:"neutral"==i?a.checked=!0:t.checked=!0}"none"===document.getElementById("measure-container"+l+chartId).style.display?(d.checked=!0,o.checked=!1):(o.checked=!0,d.checked=!1),d.addEventListener("change",dimensionEvent),o.addEventListener("change",measureEvent)}catch(e){console.log(e)}},200)}function unSelectCoumn(){let e=document.querySelectorAll("#tell-data"+chartId+"  .card");if(e.length>0)for(let a=0;a<e.length;a++){let n=e[a].getAttribute("data-attr");if("nondraggable"!==n){if(!ootbColumns.some(function(e){return e.name===n})){e[a].parentNode.removeChild(e[a]),window.sessionStorage.removeItem("columns"+chartId);for(var t=0;t<_this["columns"+chartId].length;t++)if(_this["columns"+chartId][t].name===n){_this["columns"+chartId].splice(t,1);break}}}}else if(null!==presistData.columns&&void 0!==presistData.columns)for(var a=JSON.parse(presistData.columns),n=0;n<a.length;n++){var i=a[n].name;ootbColumns.some(function(e){return e.name===i})||(a.splice(n,1),_this["columns"+chartId]=a)}}function dimensionEvent(){try{let e=this.getAttribute("data-input"),t=document.getElementById("measure-container"+e+chartId),a=document.getElementById("measure"+e+chartId),n=document.getElementById("increase-container"+e+chartId);null!==n&&(n.style.display="none"),null!=t&&(t.style.display="none"),a.checked=!1;let i=document.querySelector("#content"+e+chartId+" .measure-list");i.classList.add("text-center"),$("#qlikContainer"+chartId).width()>640&&i.classList.remove("text-left");let l=document.getElementById("select-entity"+e+chartId);l.innerHTML="";let r=document.createElement("option");r.text="Select",r.value="",l.appendChild(r);for(let t=0;t<entityType.entityTypes.length;t++){let a=document.createElement("option");a.text=entityType.entityTypes[t],a.value=entityType.entityTypes[t],document.getElementById("select-entity"+e+chartId).appendChild(a)}fieldUpdate=!0}catch(e){console.log(e)}}function measureEvent(){try{let e=this.getAttribute("data-input"),t=document.getElementById("measure-container"+e+chartId),a=document.getElementById("dimension"+e+chartId);null!==t&&(t.style.display="inline-block");let n=document.getElementById("increase-container"+e+chartId);null!==n&&(n.style.display="inline-block"),a.checked=!1;let i=document.querySelector("#content"+e+chartId+" .measure-list");i.classList.add("text-left"),$("#qlikContainer"+chartId).width()>640&&i.classList.remove("text-center");let l=document.getElementById("select-entity"+e+chartId);l.innerHTML="";let r=document.createElement("option");r.text="Select",r.value="",l.appendChild(r);for(let t=0;t<measureEntityType.entityTypes.length;t++){let a=document.createElement("option");a.text=measureEntityType.entityTypes[t],a.value=measureEntityType.entityTypes[t],document.getElementById("select-entity"+e+chartId).appendChild(a)}fieldUpdate=!0}catch(e){console.log(e)}}function setPresistedDataToDD(){if(void 0!==(presistData=chartObj.presistData||{}).drillDownData&&0!==presistData.drillDownData.length){let r=presistData.drillDownData;for(var e=0;e<r.length;e++){var t="ddf"+e+"asDropdown"+chartId,a=r[e],n=Object.keys(a)[0],i=a[n],l=(n.trim()+"_"+e+"_"+i.trim()).replace(/\s/g,"_"+e+"_");l+=chartId;let d=document.getElementById(l);if(void 0!==d&&null!==d){d.selected="true";let e=document.getElementById("select"+t);void 0===e&&null===e||(e.innerHTML=i)}}}dataModel.dataset[0].drillDowns=[];for(var r=0;r<drillDownCount;r++){var d=drillDownDataKeys[r];t="ddf"+d.replace("drillDown","")+"asDropdown"+chartId;let e=document.getElementById(t);if(void 0!==e&&null!==e){var o=drillDownUserData[d].key;if(""!==o){var s={};s[o]=e.value,dataModel.dataset[0].drillDowns.push(s)}}}}function setPresistedData_View(){if(void 0!==(presistData=chartObj.presistData||{})&&"{}"!==JSON.stringify(presistData)&&null!=presistData){if(void 0!==presistData.targetElement&&(targetElement=presistData.targetElement),void 0!==presistData.url&&(narratorUrl.value=presistData.url||""),void 0!==presistData.authValue&&(authValueElement.value=presistData.authValue||""),void 0!==presistData.customScript&&(scriptInputSimpleElement.value=presistData.customScript||""),void 0!==presistData.advance_data){var e=presistData.advance_data;narratorUrl_advance.value=e.nlgService.url,nlg_service_headers=e.nlgService.headers,insightsURL.value=e.insightService.url,insights_service_headers=e.insightService.headers,wrapperURL.value=e.wrapperService.url,wrapper_service_headers=e.wrapperService.headers,setPresistDataForNlgService(),setPresistDataForInsightService(),setPresistDataForWrapperService()}var t;if(void 0!==presistData.advance_customScript&&(advanceScriptInputSimpleElement.value=presistData.advance_customScript||""),void 0!==presistData.projectTypeFlag&&(describeTbl=JSON.parse(presistData.projectTypeFlag||"false")),void 0!==presistData.studioProjectEnabled&&(studioProjectEnabledFlg=JSON.parse(presistData.studioProjectEnabled||"false")),void 0!==presistData.drillDownData&&presistData.drillDownData.length,void 0!==presistData.analysis&&(analysisMetadata=JSON.parse(presistData.analysis)),void 0!==presistData.autoIncrementData)"simple"===(t=JSON.parse(presistData.autoIncrementData)).view&&("true"===t.check||t.check?(simpleIncrementBtn.checked=!0,autoIncrementID=!0):(autoIncrementID=!1,simpleIncrementBtn.checked=!1));if(void 0!==presistData.autoAdvanceIncrementData)"advance"===(t=JSON.parse(presistData.autoAdvanceIncrementData)).view&&(t.check||"true"===t.check?(advanceIncrementBtn.checked=!0,autoIncrementID=!0):(autoIncrementID=!1,advanceIncrementBtn.checked=!1));if("narrativeView"===targetElement){let e=void 0===presistData.narrativeText?"":presistData.narrativeText.trim();if("ootb"===(targetView=presistData.targetView)&&(e="string"==typeof e?JSON.parse(e.trim()):e.trim()),narrativeContainer.innerHTML=e,narrativeSection.style.display="block",narrativeTabElement.style.display="none",outofTabElement.style.display="none",headerSection.style.display="none",debounce||drillDownFilter)if(drillDownFilter=!1,"ootb"===targetView){pageloader.style.display="block",narrationCall&&(initializeOOTB(),presistOOTBLoad=!0);void 0!==presistData.ootbData&&JSON.parse(presistData.ootbData),generateOOTBNarrative()}else _this["callNarration"+chartId]&&(pageloader.style.display="block","simple"==targetView?(checkSliderBtn.checked=!1,""!==scriptInputSimpleElement.value?customMappingScript():customScriptAppendElement.value="",callUpdate(narratorUrl.value.trim())):(checkSliderBtn.checked=!0,""!==advanceScriptInputSimpleElement.value?customMappingScript():customScriptAppendElement.value="",callNarrativeForAdvance()))}else if(void 0!==presistData.targetView)if("ootb"==(targetView=presistData.targetView)){outofTabElement.style.display="block",tabBoxElement.classList.add("active"),tabNarrativeElement.classList.remove("active"),narrativeTabElement.style.display="none",initializeOOTB(),"block"===document.getElementById("tell-summary"+chartId).style.display?ootb_generateBtn.removeAttribute("disabled"):ootb_generateBtn.setAttribute("disabled","disabled")}else outofTabElement.style.display="none",tabBoxElement.classList.remove("active"),tabNarrativeElement.classList.add("active"),narrativeTabElement.style.display="block","simple"===targetView?(checkSliderBtn.checked=!1,enableOpenStudioBtn(narratorUrl)):(checkSliderBtn.checked=!0,enableOpenStudioBtn(narratorUrl_advance)),initialViewVisibility()}}function setPresistDataForNlgService(){var e=Object.keys(nlg_service_headers);if(nlgHeaderDynamicElCount=e.length,1===e.length){let t=document.getElementById("nlg_authKey_0"+chartId),a=document.getElementById("nlg_authValue_0"+chartId);t.value=e[0],a.value=nlg_service_headers[e[0]]}else if(e.length>1){let l=document.getElementById("nlg_authKey_0"+chartId),r=document.getElementById("nlg_authValue_0"+chartId);l.value=e[0],r.value=nlg_service_headers[e[0]];for(var t=1;t<e.length;t++){var a=e[t],n=nlg_service_headers[e[t]],i=t+chartId;if(void 0===document.getElementById("nlg_authKey_"+i)){let e=document.createElement("div");e.setAttribute("class","col-md-12 auth-header");let t='<div class="col-md-4"><input type="text" placeholder="Key" id=nlg_authKey_'+i+" value = "+a+'></div><div class="col-md-8"><input type="text" placeholder="Value" id=nlg_authValue_'+i+" value = "+n+"></div>";e.innerHTML=t,document.querySelector("#advance-mode"+chartId+" .dynamic-header .append-container").appendChild(e),removeDynamicHeaderBtn.style.display="inline"}}}}function setPresistDataForInsightService(){var e=Object.keys(insights_service_headers);if(insightsHeaderDynamicElCount=e.length,1===e.length){let t=document.getElementById("insights_authKey_0"+chartId),a=document.getElementById("insights_authValue_0"+chartId);t.value=e[0],a.value=insights_service_headers[e[0]]}else if(e.length>1){let l=document.getElementById("insights_authKey_0"+chartId),r=document.getElementById("insights_authValue_0"+chartId);l.value=e[0],r.value=insights_service_headers[e[0]];for(var t=1;t<e.length;t++){var a=e[t],n=insights_service_headers[e[t]],i=t+chartId;if(void 0===document.getElementById("insights_authKey_"+i)){let e=document.createElement("div");e.setAttribute("class","col-md-12 auth-header");let t='<div class="col-md-4"><input type="text" placeholder="Key" id=insights_authKey_'+i+" value = "+a+'></div><div class="col-md-8"><input type="text" placeholder="Value" id=insights_authValue_'+i+" value = "+n+"></div>";e.innerHTML=t,document.querySelector("#advance-mode"+chartId+" .insight-content .append-container").appendChild(e),removeInsightHeaderBtn.style.display="inline"}}}}function setPresistDataForWrapperService(){var e=Object.keys(wrapper_service_headers);if(wrapperHeaderDynamicElCount=e.length,1===e.length){let t=document.getElementById("wrapper_authKey_0"+chartId),a=document.getElementById("wrapper_authValue_0"+chartId);t.value=e[0],a.value=wrapper_service_headers[e[0]]}else if(e.length>1){let l=document.getElementById("wrapper_authKey_0"+chartId),r=document.getElementById("wrapper_authValue_0"+chartId);l.value=e[0],r.value=wrapper_service_headers[e[0]];for(var t=1;t<e.length;t++){var a=e[t],n=wrapper_service_headers[e[t]],i=t+chartId;if(void 0===document.getElementById("wrapper_authKey_"+i)){let e=document.createElement("div");e.setAttribute("class","col-md-12 auth-header");let t='<div class="col-md-4"><input type="text" placeholder="Key" id=wrapper_authKey_'+i+" value = "+a+'></div><div class="col-md-8"><input type="text" placeholder="Value" id=wrapper_authValue_'+i+" value = "+n+"></div>";e.innerHTML=t,document.querySelector("#advance-mode"+chartId+" .wrapper-content .append-container").appendChild(e),removeWrapperHeaderBtn.style.display="inline"}}}}function presistOrderColumns(){let e=ootbModel.narrativeConfigMetaData.characterization,t=[];for(let a=0;a<e.length;a++)"dimension"===e[a].attributeType?t.push({name:e[a].attributeName,measure:!1}):t.push({name:e[a].attributeName,measure:!0,measureType:"sum"});let a={},n=document.querySelectorAll("#tell-what"+chartId+"  .card");for(let e=0;e<n.length;e++){let t=JSON.stringify(n[e].classList),i=n[e].getAttribute("id");"analysisNonDrag"!==(i=i.replace(chartId,""))&&(-1!==t.indexOf("disable")?a[i]=!1:a[i]=!0)}presistData.analysis=JSON.stringify(a),presistData.columns=[],presistData.columns=JSON.stringify(t),savePresistData(presistData)}function fetchDrillDownData(e){try{for(var t=drillDownLayout.children,a=t.length,n=0;n<a;n++){var i=t[n].getAttribute("id"),l=t[n].getAttribute("tableName");if(-1!==i.indexOf("asParentDiv")&&!drillDownDataKeys.includes(l)){let e=document.getElementById(i);void 0===e.children[0]&&null===e.children[0]||(e.removeChild(e.children[0]),e.style.display="none")}}}catch(e){console.log(e)}try{for(var r=0;r<drillDownCount;r++){var d=drillDownDataKeys[r],o=d.replace("drillDown",""),s="ddf"+o+"asDiv"+chartId,c="ddf"+o+"asParentDiv"+chartId,m="ddf"+o+"asLabel"+chartId,u="ddf"+o+"asDropdown"+chartId,p=drillDownUserData[d].label,y=drillDownUserData[d].fields;void 0!==y&&null!==y&&(y=y.split(","));var h=document.getElementById(c);if(void 0===h||null===h){var g=document.createElement("div");g.setAttribute("id",c),g.setAttribute("tableName",d),g.setAttribute("class","dd-ParentDiv"),g.style.maxWidth=drillDownWidth+"%",drillDownLayout.appendChild(g)}var v=document.getElementById(s);if(void 0===v||null===v){var I=document.createElement("div");I.setAttribute("id",s),I.setAttribute("class","dropparent"),(b=document.createElement("Label")).innerHTML=p,b.setAttribute("id",m),I.appendChild(b);let e=document.createElement("select");e.setAttribute("id",u),e.setAttribute("tableName",d),e.setAttribute("position",o),I.appendChild(e);let t=document.createElement("div");t.setAttribute("id","dropcontainer"+u),t.setAttribute("class","select-container"),I.appendChild(t);let a=document.createElement("ul");a.setAttribute("id","dropDown"+u),a.setAttribute("class","drop-select"),a.setAttribute("tableName",d),a.setAttribute("position",o),t.appendChild(a);let n=document.createElement("div");n.setAttribute("id","select"+u),n.setAttribute("tableName",d),n.setAttribute("class","dropdown"),n.innerHTML=y[0],t.appendChild(n),e.style.display="none",void 0!==(h=document.getElementById(c))&&null!==h&&(h.appendChild(I),h.style.display="table"),e.addEventListener("change",function(){this.getAttribute("tableName");var e=this.getAttribute("position");onDrillDownFilterChange(drillDownUserData[drillDownDataKeys[e]].key,this.value,e)},!1),n.addEventListener("click",function(){let e=this.parentElement.getAttribute("id"),t=document.querySelector("#"+e+" ul");"block"===t.style.display?t.style.display="none":t.style.display="block"})}else{var b;void 0!==(b=document.getElementById(m))&&null!==b&&(b.innerHTML=p)}let e=document.getElementById("dropDown"+u);e.innerHTML="";var E=drillDownUserData[d].key,w=document.getElementById(u);w.innerHTML="";for(n=0;n<y.length;n++){var f=y[n],D=(E.trim()+"_"+o+"_"+f.trim()).replace(/\s/g,"_"+o+"_");D+=chartId;var L=document.getElementById(D);if(void 0==L||null==L){var S=document.createElement("option");S.text=f,S.value=f,S.id=D,void 0!==w&&null!==w&&w.appendChild(S)}let t=document.getElementById("drop"+D);if(void 0==t||null==t){let t=document.createElement("li");t.id="drop"+D,t.innerHTML=f,void 0!==e&&null!==e&&(e.appendChild(t),t.addEventListener("click",function(){let e=this.parentElement.getAttribute("id");e=e.substr(8);let t=this.innerHTML,a=document.getElementById(e);a.value=t;let n=new Event("change");a.dispatchEvent(n),document.getElementById("select"+e).innerHTML=t;let i=document.querySelectorAll(".drop-select");for(let e=0;e<i.length;e++)i[e].style.display="none"}))}}}}catch(e){console.log(e)}}function callNarratives(){if("narrativeView"==targetElement){let e=void 0==presistData.narrativeText?"":presistData.narrativeText.trim();narrativeContainer.innerHTML=e,narrativeSection.style.display="block",narrativeTabElement.style.display="none",outofTabElement.style.display="none",headerSection.style.display="none",pageloader.style.display="block","ootb"==targetView?generateOOTBNarrative():"simple"==targetView?(""!=scriptInputSimpleElement.value?customMappingScript():customScriptAppendElement.value="",callUpdate(narratorUrl.value.trim())):(""!=advanceScriptInputSimpleElement.value?customMappingScript():customScriptAppendElement.value="",callNarrativeForAdvance())}else if(void 0!=presistData.targetView)if("ootb"==(targetView=presistData.targetView)){outofTabElement.style.display="block",tabBoxElement.classList.add("active"),tabNarrativeElement.classList.remove("active"),narrativeTabElement.style.display="none","block"==document.getElementById("tell-summary"+chartId).style.display?ootb_generateBtn.removeAttribute("disabled"):ootb_generateBtn.setAttribute("disabled","disabled")}else outofTabElement.style.display="none",tabBoxElement.classList.remove("active"),tabNarrativeElement.classList.add("active"),narrativeTabElement.style.display="block","simple"==targetView?(checkSliderBtn.checked=!1,enableOpenStudioBtn(narratorUrl)):(checkSliderBtn.checked=!0,enableOpenStudioBtn(narratorUrl_advance)),initialViewVisibility()}function onDrillDownFilterChange(e,t,a){drillDownUserData=getDrillDownUserInputData(layout)||{},drillDownDataKeys=Object.keys(drillDownUserData),drillDownCount=drillDownDataKeys.length,dataModel.dataset[0].drillDowns=[];for(var n=0;n<drillDownCount;n++){var i=drillDownDataKeys[n],l="ddf"+i.replace("drillDown","")+"asDropdown"+chartId;let e=document.getElementById(l);if(void 0!==e&&null!==e){var r=drillDownUserData[i].key;if(""!==r){var d={};d[r]=e.value,dataModel.dataset[0].drillDowns.push(d)}}}drillDownFilter=!0,presistData.drillDownData=dataModel.dataset[0].drillDowns,savePresistData(presistData)}function getDrillDownUserInputData(e){for(var t={},a=0;a<drillDownFilterCount;a++){var n="drillDown"+a;let d="drillDownFilterLbl"+a,o="drillDownFilterVal"+a;var i=e["drillDownFilterKey"+a]||"",l=e[d]||"",r=e[o]||"";""!==i&&""!==l&&""!==r&&(t[n]={key:i,label:l,fields:r})}return t}function initialViewVisibility(){if("block"!==narrativeSection.style.display)if("block"!==narrativeTabElement.style.display)if("ootb"===targetView){tabBoxElement.classList.add("active"),tabNarrativeElement.classList.remove("active"),outofTabElement.style.display="block",narrativeTabElement.style.display="none","block"===document.getElementById("tell-summary"+chartId).style.display?ootb_generateBtn.removeAttribute("disabled",!0):ootb_generateBtn.setAttribute("disabled",!0),$("#qlikContainer"+chartId+" header").css({"border-bottom":"2px solid #1382bc"})}else tabBoxElement.classList.remove("active"),tabNarrativeElement.classList.add("active"),outofTabElement.style.display="none",narrativeTabElement.style.display="block";else $("#qlikContainer"+chartId+" header").css({"border-bottom":"2px solid #1db5ac"}),tabBoxElement.classList.remove("active"),outofTabElement.style.display="none",narrativeTabElement.style.display="block",tabNarrativeElement.classList.add("active"),checkSliderBtn.checked?(advance_studio_toggle.checked=studioProjectEnabledFlg,advance_studio_type.style.display=studioProjectEnabledFlg?"inline-block":"none",simpleUiContainer.style.display="none",advanceUiContainer.style.display="block",simpleText.classList.remove("active"),advanceText.classList.add("active"),describeTbl&&advance_studio_toggle.checked?(advanceTableBtn.checked=!0,advancedownloadJsonBtn.style.display="none",advancedownloadCsvBtn.style.display="inline-block",advanceCSVPayloadDiv.style.display="inline-block",advanceCustomScriptElement.parentElement.setAttribute("class","col-md-4 export"),advanceDatasetJsonElement.parentElement.setAttribute("class","col-md-4 data-json"),"block"===advanceExport.style.display?document.querySelector("#advancedata-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_up_black.png" class="arrow"><label>View Dataset in CSV</label>':document.querySelector("#advancedata-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_white.png" class="arrow"><label>View Dataset in CSV</label>',advanceCheckboxContainer.style.display="block"):(advanceExportBtn.checked=!0,advancedownloadJsonBtn.style.display="inline-block",advancedownloadCsvBtn.style.display="none",advanceCSVPayloadDiv.style.display="none",advanceCustomScriptElement.parentElement.setAttribute("class","col-md-6 export"),advanceDatasetJsonElement.parentElement.setAttribute("class","col-md-6 data-json"),"block"===advanceExport.style.display?document.querySelector("#advancedata-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_up_black.png" class="arrow"><label>View Dataset in JSON</label>':document.querySelector("#advancedata-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_white.png" class="arrow"><label>View Dataset in JSON</label>',advanceCheckboxContainer.style.display="none"),enableOpenStudioBtn(narratorUrl_advance)):(simpleUiContainer.style.display="block",advanceUiContainer.style.display="none",simpleText.classList.add("active"),advanceText.classList.remove("active"),describeTbl?(simpleTableBtn.checked=!0,downloadJsonBtn.style.display="none",downloadCsvBtn.style.display="inline-block",simpleCSVPayloadDiv.style.display="inline-block",customScriptElement.parentElement.setAttribute("class","col-md-4 export"),datasetJsonElement.parentElement.setAttribute("class","col-md-4 data-json"),"block"===simpleExport.style.display?(document.querySelector("#download-csv"+chartId+" img").setAttribute("src",apiEndpoint+"arria/images/download_white.png"),document.querySelector("#data-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_up_black.png" class="arrow"><label>View Dataset in CSV</label>'):(document.querySelector("#download-csv"+chartId+" img").setAttribute("src",apiEndpoint+"arria/images/download_white.png"),document.querySelector("#data-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_white.png" class="arrow"><label>View Dataset in CSV</label>'),simpleCheckboxContainer.style.display="block"):(simpleExportBtn.checked=!0,downloadJsonBtn.style.display="inline-block",downloadCsvBtn.style.display="none",simpleCSVPayloadDiv.style.display="none",customScriptElement.parentElement.setAttribute("class","col-md-6 export"),datasetJsonElement.parentElement.setAttribute("class","col-md-6 data-json"),"block"===simpleExport.style.display?(document.querySelector("#download-json"+chartId+" img").setAttribute("src",apiEndpoint+"arria/images/download_white.png"),document.querySelector("#data-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_up_black.png" class="arrow"><label>View Dataset in JSON</label>'):(document.querySelector("#download-json"+chartId+" img").setAttribute("src",apiEndpoint+"arria/images/download_white.png"),document.querySelector("#data-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_white.png" class="arrow"><label>View Dataset in JSON</label>'),simpleCheckboxContainer.style.display="none")),checkSliderBtn.checked?enableOpenStudioBtn(narratorUrl_advance):enableOpenStudioBtn(narratorUrl);else ootb_generateBtn.setAttribute("disabled",!0)}function disableEditMode(){"edit"===qlik.navigation.getMode()?maximize||(disableContainer.style.display="block"):disableContainer.style.display="none"}function simpleJsonDataView(){downloadCsvBtn.style.display="none",downloadJsonBtn.style.display="inline-block",simpleCSVPayloadDiv.style.display="none",customScriptElement.parentElement.setAttribute("class","col-md-6 export"),datasetJsonElement.parentElement.setAttribute("class","col-md-6 data-json"),describeTbl=!1,"block"===simpleExport.style.display?(document.querySelector("#download-json"+chartId+" img").setAttribute("src",apiEndpoint+"arria/images/download_white.png"),document.querySelector("#data-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_up_black.png" class="arrow"><label>View Dataset in JSON</label>'):(document.querySelector("#download-json"+chartId+" img").setAttribute("src",apiEndpoint+"arria/images/download_white.png"),document.querySelector("#data-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_white.png" class="arrow"><label>View Dataset in JSON</label>')}function advanceJsonDataView(){advancedownloadCsvBtn.style.display="none",advancedownloadJsonBtn.style.display="inline-block",advanceCSVPayloadDiv.style.display="none",advanceCustomScriptElement.parentElement.setAttribute("class","col-md-6 export"),advanceDatasetJsonElement.parentElement.setAttribute("class","col-md-6 data-json"),describeTbl=!1,"block"===advanceExport.style.display?(document.querySelector("#advancedownload-json"+chartId+" img").setAttribute("src",apiEndpoint+"arria/images/download_white.png"),document.querySelector("#advancedata-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_up_black.png" class="arrow"><label>View Dataset in JSON</label>'):(document.querySelector("#advancedownload-json"+chartId+" img").setAttribute("src",apiEndpoint+"arria/images/download_white.png"),document.querySelector("#advancedata-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_white.png" class="arrow"><label>View Dataset in JSON</label>')}function showData(){let e;var t=dataModel.dataset[0];let a={};a.metadata=t.metadata,a.measures=t.measures,a.column_names=t.column_names,a.hierarchies=t.hierarchies,a.drillDowns=t.drillDowns,a._id=dataModel._id,a.source=dataModel.source,a.chartType=dataModel.chartType;let n={vars:a};if(projectArgumentsNarrative={vars:a},checkSliderBtn.checked?(e=document.getElementById("advance-jsonexport"+chartId),advanceCSVContainer.innerHTML=JSON.stringify(n)):(e=document.getElementById("simple-jsonexport"+chartId),simpleCSVContainer.innerHTML=JSON.stringify(n)),describeTbl){let e=[];if("simple"===targetView?autoIncrementID=!!simpleIncrementBtn.checked:"advance"===targetView&&(autoIncrementID=!!advanceIncrementBtn.checked),autoIncrementID){if("_ID"!==csv_columnData[0]){csv_columnData.unshift("_ID");for(var i=0;i<csv_rowData.length;i++)csv_rowData[i].unshift(i+1)}}else if("_ID"===csv_columnData[0]){csv_columnData.splice(0,1);for(i=0;i<csv_rowData.length;i++)csv_rowData[i].splice(0,1)}(e=e.concat(csv_rowData)).splice(0,0,csv_columnData),csvData=convertToCSV(e)}e.innerHTML=describeTbl?csvData:JSON.stringify(dataModel)}function customMappingScript(){let initalScript=document.getElementById("inital-script"+chartId);null!==initalScript&&initalScript.parentNode.removeChild(initalScript);let jsonElement=document.getElementById("json-holder"+chartId);null!==jsonElement&&jsonElement.parentNode.removeChild(jsonElement);let jsonTag=document.createElement("textarea");jsonTag.setAttribute("id","json-holder"+chartId),jsonTag.setAttribute("style","display:none;"),jsonTag.value=describeTbl?JSON.stringify(projectArgumentsNarrative):JSON.stringify(dataModel),document.body.appendChild(jsonTag),checkSliderBtn.checked?eval(advanceScriptInputSimpleElement.value):eval(scriptInputSimpleElement.value)}function getData(){var e=document.getElementById("json-holder"+chartId).value;return""!==e&&(void 0!==e&&null!==e&&(e=e.trim()),e=JSON.parse(e)),e}function setData(e){document.getElementById("jsbuilderoutput"+chartId).value=JSON.stringify(e)}function downloadCSV_Data(){let e="";var t=[];(t=t.concat(csv_rowData)).splice(0,0,csv_columnData);var a=JSON.stringify({data:t});a=a.replace(/\s\s+/g," "),e="data="+encodeURIComponent(a);let n=new XMLHttpRequest;if(validateWrapperURL(),n.open("POST",apiEndpoint+"arria/saveCSVfile"),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),"advance"===targetView){""!==document.getElementById("wrapperURL"+chartId).value?appendWrapperHeaders(n):n.setRequestHeader("Authorization","Basic "+authorizationValue)}else n.setRequestHeader("Authorization","Basic "+authorizationValue);n.onreadystatechange=(()=>{n.readyState===XMLHttpRequest.DONE&&window.open(apiEndpoint+"arria/download?id="+n.responseText+"&ext=csv")}),window.navigator.onLine?n.send(e):showModal("You are offline. Please check that you are connected to the Internet",chartId)}function extractHostname(e){return(e.indexOf("//")>-1?e.split("/")[2]:e.split("/")[0]).split(":")[0].split("?")[0]}function downloadJSON_Data(){let e;e=checkSliderBtn.checked?document.getElementById("advance-jsonexport"+chartId):document.getElementById("simple-jsonexport"+chartId);let t="",a="";""===(a=checkSliderBtn.checked?advanceScriptInputSimpleElement.value:scriptInputSimpleElement.value)?customScriptAppendElement.value="":customMappingScript(),t=""!==customScriptAppendElement.value?"data="+encodeURIComponent(customScriptAppendElement.value):"data="+encodeURIComponent(e.textContent);let n=new XMLHttpRequest;if(validateWrapperURL(),n.open("POST",apiEndpoint+"arria/savefile"),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),"advance"===targetView){""!==document.getElementById("wrapperURL"+chartId).value?appendWrapperHeaders(n):n.setRequestHeader("Authorization","Basic "+authorizationValue)}else n.setRequestHeader("Authorization","Basic "+authorizationValue);n.onreadystatechange=(()=>{n.readyState===XMLHttpRequest.DONE&&window.open(apiEndpoint+"arria/download?id="+n.responseText+"&ext=json")}),window.navigator.onLine?n.send(t):showModal("You are offline. Please check that you are connected to the Internet",chartId)}function enableOpenStudioBtn(e){var t=e.value;""==t?(openStudioBtn.disabled=!0,openStudioBtn.style.backgroundColor="#4d4d4d"):-1!=t.indexOf("studio.arria.com:443/alite_content_generation_webapp/text/")&&""!=t.split("text/").splice(-1)?(openStudioBtn.disabled=!1,openStudioBtn.style.backgroundColor="#00a9ce"):checkSliderBtn.checked&&advance_studio_toggle.checked&&url_Pattern.test(t)?(openStudioBtn.disabled=!1,openStudioBtn.style.backgroundColor="#00a9ce"):(openStudioBtn.disabled=!0,openStudioBtn.style.backgroundColor="#4d4d4d")}function enableStudioType(e){-1!=e.value.indexOf("studio.arria.com")?advance_studio_toggle.checked||(advance_studio_toggle.checked=!0,advance_studio_toggle.onchange()):advance_studio_toggle.checked&&(advance_studio_toggle.checked=!1,advance_studio_toggle.onchange())}function generateNarrative(){try{spinner.style.display="inline",checkSliderBtn.checked?(""!==advanceScriptInputSimpleElement.value?customMappingScript():customScriptAppendElement.value="",""===narratorUrl_advance.value?(spinner.style.display="none",showModal("Please enter a valid NLG Service URL",chartId)):callNarrativeForAdvance()):(""!==scriptInputSimpleElement.value?customMappingScript():customScriptAppendElement.value="",""!==narratorUrl.value&&narratorUrl.value.match(/((https:\/\/)+(\w.)+(studio.arria.com)+(:[0-9]{2,6}\/)+(alite_content_generation_webapp\/text\/)+[-a-zA-Z0-9])|(http:\/\/studio.arria.com\/)/g)?""==authValueElement.value?(spinner.style.display="none",showModal("Please enter a valid API Key",chartId)):(presistData.url=narratorUrl.value,presistData.authKey="Authorization",presistData.authValue=authValueElement.value,presistData.customScript=scriptInputSimpleElement.value,""!==presistSimplecheck&&(presistData.autoIncrementData=JSON.stringify(presistSimplecheck)),""!==presistAdvanceCheck&&(presistData.autoAdvanceIncrementData=JSON.stringify(presistAdvanceCheck)),savePresistData(presistData),callUpdate(narratorUrl.value)):(spinner.style.display="none",showModal("Please enter a valid Studio Project URL",chartId)))}catch(e){console.log(e)}}function showModal(e,t){$("#modaldata"+t).html(e),$("#modal"+t).show(),$("#narratorUrl"+t).focus()}function savePresistData(e){chartObj.presistData=e,_this.backendApi.setProperties(chartObj)}function callNarrativeForAdvance(){let e=document.getElementById("pageloader"+chartId);"none"===e.style.display&&(e.style.display="block");var t=getNLGServiceURLHeaders();if("{}"!=JSON.stringify(t)||-1==narratorUrl_advance.value.indexOf("studio.arria.com")){var a=getInsightsURLHeaders(),n=getWrapperURLHeaders(),i={insights_service_headers:a,wrapper_service_headers:n,nlg_service_headers:t},l={nlgService:{url:narratorUrl_advance.value,headers:t},insightService:{url:insightsURL.value,headers:a},wrapperService:{url:wrapperURL.value,headers:n}};presistData.advance_data=l,presistData.advance_customScript=advanceScriptInputSimpleElement.value,""!==presistSimplecheck&&(presistData.autoIncrementData=JSON.stringify(presistSimplecheck)),""!=presistAdvanceCheck&&(presistData.autoAdvanceIncrementData=JSON.stringify(presistAdvanceCheck)),savePresistData(presistData),callGenerateTxtForAdvance(""!==insightsURL.value?2:1,i)}else spinner.style.display="none",showModal("Please enter a valid Header Key/Value pair",chartId)}function callGenerateTxtForAdvance(e,t){document.getElementById("narrative-section"+chartId);let a,n=document.getElementById("narrative-container"+chartId),i=(document.getElementById("outofbox-tabsection"+chartId),document.getElementById("narrative-tabsection"+chartId),document.getElementById("insightsURL"+chartId)),l=(document.getElementById("wrapperURL"+chartId),document.getElementById("narratorUrl_advance"+chartId)),r="",d="",o="",s=new XMLHttpRequest;2===e?(r=i.value,a=t.insights_service_headers):(r=l.value,a=t.nlg_service_headers);try{xmlhttpConfiguration(s),s.onreadystatechange=(()=>{let c;if(s.readyState===XMLHttpRequest.DONE)if("undefined"!==s.responseText)if((c=JSON.parse(s.responseText)).type)if(2===e){let h={};try{if(e-=1,r=l.value,a=t.nlg_service_headers,studioProjectEnabledFlg)if(describeTbl){var m=csv_columnData,u=csv_rowData;if(!advanceIncrementBtn.checked&&"_ID"===m[0]){m.splice(0,1);for(var y=0;y<u.length;y++)u[y].splice(0,1)}let e={},t={};e.id="Primary",e.type="2d",e.dataSet=[],e.dataSet=e.dataSet.concat(u),e.dataSet.splice(0,0,m),h.data=[],h.data.push(e),""==p.value?(t.metadata=i.dataset[0].metadata,t.measures=i.dataset[0].measures,t.column_names=i.dataset[0].column_names,t.hierarchies=i.dataset[0].hierarchies,t.drillDowns=i.dataset[0].drillDowns,t._id=i._id,t.source=i.source,t.chartType=i.chartType,h.projectArguments={vars:t}):("object"!=typeof i&&(i=JSON.parse(i)),h.projectArguments=i),h.options={nullValueBehaviour:"SHOW_IDENTIFIER"}}else{let e={id:"Primary",type:"json"};"object"!=typeof c.data?e.jsonData=JSON.parse(c.data):e.jsonData=c.data,h.data=[],h.data.push(e)}else h=JSON.parse(c.data)}catch(e){return d="Insights URL response error <br><br>",d+=c.data.trim(),n.innerHTML=d,void setViewVisibility(d)}o={serviceURL:r,headers:a,appData:h,biSource:"qliksense",type:e},1===e&&-1===r.indexOf("/alite_content_generation_webapp/text/")&&(o.type=2),xmlhttpConfiguration(s),window.navigator.onLine?s.send(JSON.stringify(o)):showModal("You are offline. Please check that you are connected to the Internet",chartId)}else{if(n.innerHTML="",-1!=(d=c.data.trim()).indexOf("{color}")){let e=[];(d=d.replace(/{color}/g,"</span>")).replace(/\{(.+?)}/g,function(t,a,n){e.push({label:a,key:t})});let t="";for(let a=0;a<e.length;a++)d=(t=d).replace(e[a].key,'<span style="'+e[a].label+'">')}n.innerHTML=d,setViewVisibility(d)}else{if((d=c.error.trim()).includes("401 Unauthorized"))return showModal("Please enter a valid Header Key/Value pair",chartId),void disableLoader();if("URI is not absolute"==d)return showModal("Please enter a valid NLG Service URL",chartId),void disableLoader();n.innerHTML=d,setViewVisibility(d)}else disableLoader();else s.readyState,console.log("xmlhttp.readyState not done:",s.readyState)}),s.onerror=function(e){window.navigator.onLine?showModal(e,chartId):showModal("You are offline. Please check that you are connected to the Internet",chartId),console.log(e),disableLoader(),setViewVisibility(d="error")};let i,p=document.getElementById("jsbuilderoutput"+chartId);if(""!==p.value)i=p.value;else{document.getElementById("advance-jsonexport"+chartId);i=dataModel}let y={};if(2!==e&&studioProjectEnabledFlg)if(describeTbl){"object"!=typeof i&&(i=JSON.parse(i));var c=csv_columnData,m=csv_rowData;if(!advanceIncrementBtn.checked&&"_ID"===c[0]){c.splice(0,1);for(var u=0;u<m.length;u++)m[u].splice(0,1)}let e={},t={};e.id="Primary",e.type="2d",e.dataSet=[],e.dataSet=e.dataSet.concat(m),e.dataSet.splice(0,0,c),y.data=[],y.data.push(e),""==p.value?(t.metadata=i.dataset[0].metadata,t.measures=i.dataset[0].measures,t.column_names=i.dataset[0].column_names,t.hierarchies=i.dataset[0].hierarchies,t.drillDowns=i.dataset[0].drillDowns,t._id=i._id,t.source=i.source,t.chartType=i.chartType,y.projectArguments={vars:t}):("object"!=typeof i&&(i=JSON.parse(i)),y.projectArguments=i),y.options={nullValueBehaviour:"SHOW_IDENTIFIER"}}else{let e={id:"Primary",type:"json"};e.jsonData="object"!=typeof i?JSON.parse(i):i,y.data=[],y.data.push(e)}else y="object"!=typeof i?JSON.parse(i):i;o={serviceURL:r,headers:a,appData:y,biSource:"qliksense",type:e},1===e&&-1===r.indexOf("/alite_content_generation_webapp/text/")&&(o.type=2),window.navigator.onLine?s.send(JSON.stringify(o)):showModal("You are offline. Please check that you are connected to the Internet",chartId)}catch(e){console.log(e),disableLoader()}}function xmlhttpConfiguration(e){validateWrapperURL(),e.open("POST",apiEndpoint+"arria/nlgAdvanced"),e.setRequestHeader("Content-Type","application/json"),""===document.getElementById("wrapperURL"+chartId).value&&e.setRequestHeader("Authorization","Basic "+authorizationValue),e.setRequestHeader("userid",fingerPrintKey),appendWrapperHeaders(e)}function validateWrapperURL(){if("simple"===targetView)apiEndpoint=defaultApiEndpoint;else{let e=document.getElementById("wrapperURL"+chartId);apiEndpoint=""!==e.value?e.value:defaultApiEndpoint}}function appendWrapperHeaders(e){if("advance"===targetView){let n=document.querySelector("#advance-mode"+chartId+" .wrapper-content .append-container").childElementCount;for(var t=0;t<n+1;t++){var a=t+chartId;let n=document.getElementById("wrapper_authKey_"+a),i=document.getElementById("wrapper_authValue_"+a);if(""!==n.value||""!==i.value){if(""==n.value||""==i.value){showModal("Please enter a valid Header Key/Value pair",chartId);break}e.setRequestHeader([n.value],i.value)}}}}function callUpdate(e){let t=document.getElementById("pageloader"+chartId);"none"==t.style.display&&(t.style.display="block");let a="",n=new XMLHttpRequest,i=(document.getElementById("narrative-section"+chartId),document.getElementById("narrative-container"+chartId));document.getElementById("outofbox-tabsection"+chartId),document.getElementById("narrative-tabsection"+chartId);try{let t=document.getElementById("authValue"+chartId);n.open("POST",apiEndpoint+"arria/nlg"),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.setRequestHeader("Authorization","Basic "+authorizationValue),n.setRequestHeader("userid",fingerPrintKey),n.onreadystatechange=(()=>{if(n.readyState===XMLHttpRequest.DONE)if("undefined"!==n.responseText){let e=JSON.parse(n.responseText);if(e.type){if(i.innerHTML="",-1!=(a=e.data.trim()).indexOf("{color}")){let e=[];(a=a.replace(/{color}/g,"</span>")).replace(/\{(.+?)}/g,function(t,a,n){e.push({label:a,key:t})});let t="";for(let n=0;n<e.length;n++)a=(t=a).replace(e[n].key,'<span style="'+e[n].label+'">')}i.innerHTML=a}else{if((a=e.error.trim()).includes("401 Unauthorized"))return showModal("Please enter a valid API Key",chartId),void disableLoader();if("URI is not absolute"==a)return showModal("Please enter a valid Studio Project URL",chartId),void disableLoader();i.innerHTML=a}setViewVisibility(a)}else disableLoader();else n.readyState,console.log("xmlhttp.readyState not done:",n.readyState)}),n.onerror=function(e){window.navigator.onLine?showModal(e,chartId):showModal("You are offline. Please check that you are connected to the Internet",chartId),disableLoader(),setViewVisibility(a="error")};let o,s=document.getElementById("jsbuilderoutput"+chartId),c="";if(""!==s.value)o=s.value;else{let e=document.getElementById("advance-jsonexport"+chartId);e=document.getElementById("change-ui"+chartId).checked?document.getElementById("advance-jsonexport"+chartId):document.getElementById("simple-jsonexport"+chartId),o=dataModel}let m,u={};if(-1!==e.indexOf("studio.arria.com"))if(describeTbl){"object"!=typeof o&&(o=JSON.parse(o));var l=csv_columnData,r=csv_rowData;if(!simpleIncrementBtn.checked&&"_ID"===l[0]){l.splice(0,1);for(var d=0;d<r.length;d++)r[d].splice(0,1)}let e={},t={};e.id="Primary",e.type="2d",e.dataSet=[],e.dataSet=e.dataSet.concat(r),e.dataSet.splice(0,0,l),u.data=[],u.data.push(e),""==s.value?(t.metadata=o.dataset[0].metadata,t.measures=o.dataset[0].measures,t.column_names=o.dataset[0].column_names,t.hierarchies=o.dataset[0].hierarchies,t.drillDowns=o.dataset[0].drillDowns,t._id=o._id,t.source=o.source,t.chartType=o.chartType,u.projectArguments={vars:t}):("object"!=typeof o&&(o=JSON.parse(o)),u.projectArguments=o),u.options={nullValueBehaviour:"SHOW_IDENTIFIER"},m=JSON.stringify(u)}else{let e={id:"Primary",type:"json"};e.jsonData="object"!=typeof o?JSON.parse(o):o,u.data=[],u.data.push(e),m=JSON.stringify(u)}else m=u=o;m=m.replace(/\s\s+/g," "),c=-1!==e.indexOf("studio.arria.com")?"arriaURL="+e+"&headername=Authorization&authKey=bearer "+t.value.trim()+"&appData="+encodeURIComponent(m)+"&biSource=qliksense":""!==t.value?"arriaURL="+e+"&headername=Authorization&authKey=bearer "+t.value.trim()+"&appData="+encodeURIComponent(m)+"&biSource=qliksense":"arriaURL="+e+"&appData="+encodeURIComponent(m)+"&biSource=qliksense",window.navigator.onLine?n.send(c):showModal("You are offline. Please check that you are connected to the Internet",chartId)}catch(e){console.log(e),disableLoader()}}function setViewVisibility(e){narrativeSection.style.display="block",narrativeTabElement.style.display="none",outofTabElement.style.display="none",headerSection.style.display="none",disableLoader(),targetElement="narrativeView",presistData.narrativeText=e,presistData.projectTypeFlag=JSON.stringify(describeTbl),presistData.targetElement=targetElement,presistData.drillDownData=dataModel.dataset[0].drillDowns,presistData.studioProjectEnabled=JSON.stringify(studioProjectEnabledFlg),savePresistData(presistData)}function disableLoader(){let e=document.querySelector("#narrative-tabsection"+chartId+" .generate_btn img"),t=document.getElementById("pageloader"+chartId);e.style.display="none",t.style.display="none"}function getNLGServiceURLHeaders(){var e={};let t=document.querySelector("#advance-mode"+chartId+" .dynamic-header .append-container").childElementCount;nlgHeaderDynamicElCount=t+1;for(var a=0;a<nlgHeaderDynamicElCount;a++){var n=a+chartId;let t=document.getElementById("nlg_authKey_"+n),i=document.getElementById("nlg_authValue_"+n);if(""===t.value||""===i.value)return{};e[t.value]=i.value}return e}function getInsightsURLHeaders(){var e={};let t=document.querySelector("#advance-mode"+chartId+" .insight-content .append-container").childElementCount;insightsHeaderDynamicElCount=t+1;for(var a=0;a<insightsHeaderDynamicElCount;a++){var n=a+chartId;let t=document.getElementById("insights_authKey_"+n),i=document.getElementById("insights_authValue_"+n);if(""!==t.value||""!==i.value){if(""===t.value||""===i.value)return{};e[t.value]=i.value}}return e}function getWrapperURLHeaders(){var e={};let t=document.querySelector("#advance-mode"+chartId+" .wrapper-content .append-container").childElementCount;wrapperHeaderDynamicElCount=t+1;for(var a=0;a<wrapperHeaderDynamicElCount;a++){var n=a+chartId;let t=document.getElementById("wrapper_authKey_"+n),i=document.getElementById("wrapper_authValue_"+n);if(""!==t.value||""!==i.value){if(""===t.value||""===i.value)return{};e[t.value]=i.value}}return e}function generateOOTBNarrative(){let e=[],t=document.getElementById("pageloader"+chartId);if(t.style.display="block",void 0!==analysisMetadata||null!==analysisMetadata){let t=document.querySelectorAll("#tell-what"+chartId+"  .card");for(let a=0;a<t.length;a++){let n=t[a].getAttribute("id");if(n==="stats"+chartId){let t=document.querySelector('input[name="stats'+chartId+'"]');if(analysisMetadata.stats&&t.checked){e.push({analysisType:"descriptiveStats",rank:e.length+1});let t=document.getElementById("rank-domain"+chartId),a=document.getElementById("analysis"+chartId);t.checked?e[e.length-1].ranking="domain":e[e.length-1].ranking="data",a.checked?e[e.length-1].distribution_analysis=!0:e[e.length-1].distribution_analysis=!1}}else if(n==="correlations"+chartId){if(analysisMetadata.correlations){if(document.querySelector('input[name="correlations'+chartId+'"]').checked){let t=document.querySelectorAll("#measure-container"+chartId+"  .measure");e.push({analysisType:"correlations",rank:e.length+1});let a=[];for(let e=0;e<t.length;e++){let n=t[e].getAttribute("id"),i=document.querySelector("#"+n+" select:first-child"),l=document.querySelector("#"+n+" select:last-child");a.push([i.value,l.value])}e[e.length-1].measures=a;let n=document.getElementById("low"+chartId),i=document.getElementById("strong"+chartId);e[e.length-1].thresholds={low:n.value,strong:i.value}}}}else if(n==="variance"+chartId){if(analysisMetadata.variance){if(document.querySelector('input[name="variance'+chartId+'"]').checked){if(e.push({analysisType:"varianceAnalysis",rank:e.length+1}),document.getElementById("time"+chartId).checked){let t=document.getElementById("timeperiod"+chartId),a=document.getElementById("timeComparrison"+chartId),n=document.getElementById("target-measure"+chartId);e[e.length-1].varianceType="timeBased",e[e.length-1].measure=n.value,e[e.length-1].Period=t.value,e[e.length-1].comparison=a.value}else{let t=document.querySelector('select[name="targetActual'+chartId+'"]'),a=document.querySelector('select[name="targetbudget'+chartId+'"]');e[e.length-1].varianceType="targetBased",e[e.length-1].actual=t.value,e[e.length-1].target=a.value}let t="";if(document.getElementById("variance-top"+chartId).checked){t=document.getElementById("variance-topselect"+chartId).value,e[e.length-1].entitySelection={topN:t}}else{t=document.getElementById("variance-range"+chartId).value+"%",e[e.length-1].entitySelection={coverage:t}}}}}else if(n==="timeSeries"+chartId&&analysisMetadata.timeSeries){if(document.querySelector('input[name="timeSeries'+chartId+'"]').checked){let t=document.querySelector("#timeSeries"+chartId+' input[type="range"]');e.push({analysisType:"timeSeriesAnalysis",rank:e.length+1,sensitivity:t.value})}}}}let a=document.getElementById("summary"+chartId),n=document.getElementById("keyInsights"+chartId),i=document.getElementById("everything"+chartId),l=[];a.checked&&l.push({verbosity:"summary"}),n.checked&&l.push({verbosity:"keyInsights"}),i.checked&&l.push({verbosity:"everything"});var r=0;if(debounce&&!presistOOTBLoad)r=1200,setTimeout(function(){let t=document.querySelectorAll("#tell-data"+chartId+"  .card"),a={characterization:[]};for(let e=0;e<t.length;e++){let n=t[e].getAttribute("data-id")+chartId,i=t[e].getAttribute("data-attr");if("nondraggable"!==i){let t=document.querySelector('input[name="alias'+n+'"]');t=t.value;let l=document.getElementById("select-entity"+n),r="Select";if(null!==l.options&&(r=l.options[l.selectedIndex].value),""===r&&(r=l.value),document.getElementById("dimension"+n).checked)a.characterization.push({attributeName:i,alias:t,attributeType:"dimension",entityType:r,rank:e+1});else{let l=document.querySelector('input[name="unit'+n+'"]');l=l.value;let d="";d=document.getElementById("good"+n).checked?"good":"bad",a.characterization.push({attributeName:i,alias:t,attributeType:"measure",aggregateType:ootbColumns[e].measureType,entityType:r,unit:l,increase:d,rank:e+1})}}}ootbModel.narrativeConfigMetaData.characterization=a.characterization;var n={narrativeConfigMetaData:{characterization:[],analysisOrchestration:[],generation:[]}};void 0!==presistData.ootbModel&&null!==presistData.ootbModel&&(n=JSON.parse(presistData.ootbModel)),0!==n.narrativeConfigMetaData.analysisOrchestration.length?ootbModel.narrativeConfigMetaData.analysisOrchestration=n.narrativeConfigMetaData.analysisOrchestration:ootbModel.narrativeConfigMetaData.analysisOrchestration=e,0!==n.narrativeConfigMetaData.generation.length?ootbModel.narrativeConfigMetaData.generation=n.narrativeConfigMetaData.generation:ootbModel.narrativeConfigMetaData.generation=l},1e3);else if(!debounce&&void 0!==presistData.ootbModel||"narrativeView"===targetElement){var d={narrativeConfigMetaData:{characterization:[],analysisOrchestration:[],generation:[]}};void 0!==presistData.ootbModel&&null!==presistData.ootbModel&&(d=JSON.parse(presistData.ootbModel)),0===d.narrativeConfigMetaData.characterization.length||fieldUpdate||"narrativeView"!=targetElement?0===dimensionCharacterization.length?(r=1200,setTimeout(function(){let e=document.querySelectorAll("#tell-data"+chartId+"  .card"),t={characterization:[]};for(let a=0;a<e.length;a++){let n=e[a].getAttribute("data-id")+chartId,i=e[a].getAttribute("data-attr");if("nondraggable"!=i){let e=document.querySelector('input[name="alias'+n+'"]');e=e.value;let l=document.getElementById("select-entity"+n),r="Select";if(null!==l.options&&(r=l.options[l.selectedIndex].value),""===r&&(r=l.value),document.getElementById("dimension"+n).checked)t.characterization.push({attributeName:i,alias:e,attributeType:"dimension",entityType:r,rank:a+1});else{let l=document.querySelector('input[name="unit'+n+'"]');l=l.value;let d="";d=document.getElementById("good"+n).checked?"good":"bad",t.characterization.push({attributeName:i,alias:e,attributeType:"measure",aggregateType:ootbColumns[a].measureType,entityType:r,unit:l,increase:d,rank:a+1})}}}ootbModel.narrativeConfigMetaData.characterization=t.characterization},1e3)):ootbModel.narrativeConfigMetaData.characterization=dimensionCharacterization:ootbModel.narrativeConfigMetaData.characterization=d.narrativeConfigMetaData.characterization,0!==d.narrativeConfigMetaData.analysisOrchestration.length&&0===e.length&&!1===generateBtnClicked?ootbModel.narrativeConfigMetaData.analysisOrchestration=d.narrativeConfigMetaData.analysisOrchestration:(ootbModel.narrativeConfigMetaData.analysisOrchestration=e,generateBtnClicked=!1),ootbModel.narrativeConfigMetaData.generation=l}else ootbModel.narrativeConfigMetaData.characterization=dimensionCharacterization,ootbModel.narrativeConfigMetaData.analysisOrchestration=e,ootbModel.narrativeConfigMetaData.generation=l;setTimeout(function(){presistData.ootbData=JSON.stringify(ootbModel),presistData.ootbModel=JSON.stringify(ootbModel);let e=dataModel;e.dataset[0].metadata=ootbModel;let a=document.getElementById("narrative-section"+chartId),n=document.getElementById("narrative-container"+chartId),i=document.getElementById("outofbox-tabsection"+chartId),l=new XMLHttpRequest;l.onreadystatechange=function(){if(4===this.readyState&&200===this.status&&""!==l.responseText){t.style.display="none",a.style.display="block",i.style.display="none",headerSection.style.display="none";let e="";e=(e=l.responseText).trim();try{e=JSON.parse(e)}catch(e){}n.innerHTML=e,targetElement="narrativeView",presistData.narrativeText=JSON.stringify(e),presistData.targetElement=targetElement,presistData.targetView="ootb",savePresistData(presistData),presistOOTBLoad=!0,narrationCall=!1}},l.onerror=function(e){window.navigator.onLine?showModal(e,chartId):showModal("You are offline. Please check that you are connected to the Internet",chartId),t.style.display="none"},l.open("POST",OOTBGenerateEndPoint,!0),l.setRequestHeader("x-api-key",OOTBEndPointAPIKey),l.setRequestHeader("userid",fingerPrintKey),window.navigator.onLine?l.send(JSON.stringify(e)):showModal("You are offline. Please check that you are connected to the Internet",chartId)},r)}function addMeasureTargetVariance(){let e=document.querySelector('select[name="targetActual'+chartId+'"]'),t=document.querySelector('select[name="targetbudget'+chartId+'"]'),a=document.querySelector('select[name="forecast'+chartId+'"]'),n=document.getElementById("target-measure"+chartId);for(let i=0;i<measureColumn.length;i++){let l=document.createElement("option");l.text=measureColumn[i],l.value=measureColumn[i];let r=document.createElement("option");r.text=measureColumn[i],r.value=measureColumn[i];let d=document.createElement("option");d.text=measureColumn[i],d.value=measureColumn[i];let o=document.createElement("option");o.value=measureColumn[i],o.text=measureColumn[i],e.appendChild(r),t.appendChild(d),a.appendChild(l),n.appendChild(o)}}function varianceToggle(e,t,a){let n=document.getElementById("variance-range"+chartId),i=document.getElementById("variance-topselect"+chartId);if(e.checked){t.style.display="block",a.style.display="none",i.removeAttribute("disabled"),n.setAttribute("disabled","disabled"),document.getElementById("variance-top"+chartId).checked=!0,i.parentElement.classList.remove("disable"),n.parentElement.parentElement.classList.add("disable")}else{t.style.display="none",a.style.display="block",document.getElementById("variance-coverage"+chartId).checked=!0,i.setAttribute("disabled","disabled"),n.removeAttribute("disabled"),i.parentElement.classList.add("disable"),n.parentElement.parentElement.classList.remove("disable")}}function toggleTimeTop(){let e=document.getElementById("variance-top"+chartId),t=document.getElementById("variance-range"+chartId),a=document.getElementById("variance-topselect"+chartId);e.checked?(a.removeAttribute("disabled"),t.setAttribute("disabled","disabled"),a.parentElement.classList.remove("disable"),t.parentElement.parentElement.classList.add("disable")):(a.parentElement.classList.add("disable"),a.setAttribute("disabled","disabled"),t.removeAttribute("disabled"),t.parentElement.parentElement.classList.remove("disable"))}function toggleCoverage(){let e=document.getElementById("variance-coverage"+chartId),t=document.getElementById("variance-range"+chartId),a=document.getElementById("variance-topselect"+chartId);e.checked?(a.setAttribute("disabled","disabled"),t.removeAttribute("disabled"),a.parentElement.classList.add("disable"),t.parentElement.parentElement.classList.remove("disable")):(a.removeAttribute("disabled"),t.setAttribute("disabled","disabled"),a.parentElement.classList.remove("disable"),t.parentElement.parentElement.classList.add("disable"))}function addMeasureHeader(){let e=document.getElementById("measure-container"+chartId);if(null!==e||void 0!==e){let t=document.getElementById("measure-container"+chartId).childElementCount;if(t>=1&&(document.getElementById("removemeasure-header"+chartId).style.display="inline-block"),measureColumn.length>0){let a=2,n=document.createElement("div");n.setAttribute("id","measure"+t+chartId),n.setAttribute("class","measure"),e.appendChild(n);for(let e=0;e<a;e++){let t=document.createElement("select");t.setAttribute("id","select"+e+chartId),n.appendChild(t);for(let e=0;e<measureColumn.length;e++){let a=document.createElement("option");a.value=measureColumn[e],a.text=measureColumn[e],t.appendChild(a)}}}}}function removeMeasureHeader(){let e=document.getElementsByClassName("measure").length,t=document.querySelector("#measure-container"+chartId+"  .measure:last-child");e>=2&&t.parentNode.removeChild(t),e<=2&&(document.getElementById("removemeasure-header"+chartId).style.display="none")}function getOOTBMetadata(){try{let e=document.querySelectorAll("#tell-data"+chartId+"  .card"),t={characterization:[]};measureColumn=[];for(let a=0;a<e.length;a++){let n=e[a].getAttribute("data-id")+chartId,i=e[a].getAttribute("data-attr");if("nondraggable"!==i){let e=document.querySelector('input[name="alias'+n+'"]');e=e.value;let l=document.getElementById("select-entity"+n),r=l.options[l.selectedIndex].value;if(document.getElementById("dimension"+n).checked)t.characterization.push({attributeName:i,alias:e,attributeType:"dimension",entityType:r,rank:a+1});else{let l=document.querySelector('input[name="unit'+n+'"]');l=l.value;let d=document.getElementById("good"+n),o=document.getElementById("neutral"+n),s="";s=d.checked?"good":o.checked?"neutral":"bad",t.characterization.push({attributeName:i,alias:e,attributeType:"measure",aggregationType:ootbColumns[a].measureType,entityType:r,unit:l,increase:s,rank:a+1}),measureColumn.push(i)}}}dimensionCharacterization=t.characterization,ootbModel.narrativeConfigMetaData.characterization=dimensionCharacterization;let a=document.getElementById("tell-what"+chartId);""!==analysisArray&&void 0!==analysisArray||(a.innerHTML="",pageloader.style.display="block");let n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===this.readyState&&200===this.status&&""!==n.responseText&&(analysisArray!=n.responseText||JSON.stringify(measureColumn)!=JSON.stringify(measureFields)||""==a.innerHTML)){let a;measureFields=measureColumn,void 0!=presistData.analysis?(analysisArray=presistData.analysis,a=JSON.parse(presistData.analysis),analysisMetadata=JSON.parse(presistData.analysis),presistData.analysis=void 0):(analysisArray=n.responseText,a=JSON.parse(n.responseText),analysisMetadata=JSON.parse(n.responseText));let i=Object.keys(a).length,l=Object.keys(a),r=document.getElementById("tell-what"+chartId);r.innerHTML="";for(let n=0;n<i;n++){let i;"distribution"!=l[n]&&((i=document.createElement("div")).setAttribute("class","card "+l[n]),i.setAttribute("id",l[n]+chartId),a[l[n]]?i.classList.add("active"):i.classList.add("disable"));let d="";switch(l[n]){case"stats":if(d+='<div class="card-header '+l[n]+chartId+" "+l[n]+'"><div class="drag-holder" style="background-image:url('+apiEndpoint+'arria/images/drag.png)"></div><input type="checkbox" name="'+l[n]+chartId+'" checked>Descriptive statistics <span>(Select at least one measure and one dimension from step 1)</span><img class="card-toggle '+l[n]+chartId+" "+l[n]+'" src="data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCIgdmlld0JveD0iMCAwIDI4NC45MjkgMjg0LjkyOSIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMjg0LjkyOSAyODQuOTI5OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxnPgoJPHBhdGggZD0iTTI4Mi4wODIsNzYuNTExbC0xNC4yNzQtMTQuMjczYy0xLjkwMi0xLjkwNi00LjA5My0yLjg1Ni02LjU3LTIuODU2Yy0yLjQ3MSwwLTQuNjYxLDAuOTUtNi41NjMsMi44NTZMMTQyLjQ2NiwxNzQuNDQxICAgTDMwLjI2Miw2Mi4yNDFjLTEuOTAzLTEuOTA2LTQuMDkzLTIuODU2LTYuNTY3LTIuODU2Yy0yLjQ3NSwwLTQuNjY1LDAuOTUtNi41NjcsMi44NTZMMi44NTYsNzYuNTE1QzAuOTUsNzguNDE3LDAsODAuNjA3LDAsODMuMDgyICAgYzAsMi40NzMsMC45NTMsNC42NjMsMi44NTYsNi41NjVsMTMzLjA0MywxMzMuMDQ2YzEuOTAyLDEuOTAzLDQuMDkzLDIuODU0LDYuNTY3LDIuODU0czQuNjYxLTAuOTUxLDYuNTYyLTIuODU0TDI4Mi4wODIsODkuNjQ3ICAgYzEuOTAyLTEuOTAzLDIuODQ3LTQuMDkzLDIuODQ3LTYuNTY1QzI4NC45MjksODAuNjA3LDI4My45ODQsNzguNDE3LDI4Mi4wODIsNzYuNTExeiIgZmlsbD0iIzk4OTg5OCIvPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+Cjwvc3ZnPgo="></div>',d+='<div class="card-content col-md-12"><div class="col-md-6 distribution-container"><div class="distribution"><span class="ranking">Ranking:</span><p> <input type="radio" name="rank'+chartId+'" id="rank-domain'+chartId+'"><label for="rank-domain'+chartId+'">Use selected attribute order</label></p><p><input type="radio" name="rank'+chartId+'" id="rank-data'+chartId+'" checked><label for="rank-data'+chartId+'" >Let us decide</label></p> </div><div class="distribution"><input type="checkbox" name="datadriven'+chartId+'" id="analysis'+chartId+'"><label for="analysis'+chartId+'">Include distribution analysis</label> </div></div></div>',i.innerHTML=d,r.appendChild(i),!a.stats){document.querySelector('input[name="stats'+chartId+'"]').checked=!1}break;case"variance":d+='<div class="card-header '+l[n]+chartId+" "+l[n]+'"> <div class="drag-holder" style="background-image:url('+apiEndpoint+'arria/images/drag.png)"></div><input type="checkbox" name="'+l[n]+chartId+'" checked>Variance <span>(Select at least 2 measures [target-based] or a measure and a date time [time-based] from step 1)</span><img class="card-toggle '+l[n]+chartId+" "+l[n]+'" src="data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCIgdmlld0JveD0iMCAwIDI4NC45MjkgMjg0LjkyOSIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMjg0LjkyOSAyODQuOTI5OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxnPgoJPHBhdGggZD0iTTI4Mi4wODIsNzYuNTExbC0xNC4yNzQtMTQuMjczYy0xLjkwMi0xLjkwNi00LjA5My0yLjg1Ni02LjU3LTIuODU2Yy0yLjQ3MSwwLTQuNjYxLDAuOTUtNi41NjMsMi44NTZMMTQyLjQ2NiwxNzQuNDQxICAgTDMwLjI2Miw2Mi4yNDFjLTEuOTAzLTEuOTA2LTQuMDkzLTIuODU2LTYuNTY3LTIuODU2Yy0yLjQ3NSwwLTQuNjY1LDAuOTUtNi41NjcsMi44NTZMMi44NTYsNzYuNTE1QzAuOTUsNzguNDE3LDAsODAuNjA3LDAsODMuMDgyICAgYzAsMi40NzMsMC45NTMsNC42NjMsMi44NTYsNi41NjVsMTMzLjA0MywxMzMuMDQ2YzEuOTAyLDEuOTAzLDQuMDkzLDIuODU0LDYuNTY3LDIuODU0czQuNjYxLTAuOTUxLDYuNTYyLTIuODU0TDI4Mi4wODIsODkuNjQ3ICAgYzEuOTAyLTEuOTAzLDIuODQ3LTQuMDkzLDIuODQ3LTYuNTY1QzI4NC45MjksODAuNjA3LDI4My45ODQsNzguNDE3LDI4Mi4wODIsNzYuNTExeiIgZmlsbD0iIzk4OTg5OCIvPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+Cjwvc3ZnPgo="></div>',d+='<div class="card-content">',d+='<div class="card-field col-md-12 text-center"><div class="col-md-6 text-right"><input type="radio" name="variance'+chartId+'" id="time'+chartId+'" checked><label for="time'+chartId+'">Time-based variance</label> </div><div class="col-md-6 text-left"><input type="radio" name="variance'+chartId+'" id="target'+chartId+'"><label for="target'+chartId+'">Target-based variance</label> </div></div>',d+='<div id="timebasedvariance'+chartId+'" class="timebasedvariance" style="display:block;text-align: center;"><div class="col-md-4"><label>Measure</label><select id="target-measure'+chartId+'"></select></div><div class="col-md-4"><label>Period</label><select name="timeperiod'+chartId+'" id="timeperiod'+chartId+'"><option value="month">Month</option><option value="quarter">Quarter</option><option value="year">Year</option></select></div><div class="col-md-4"><label>Comparison</label><select name="timeComparrison'+chartId+'" id="timeComparrison'+chartId+'"><option value="Latest vs. previous">Latest vs. previous</option><option value="Latest vs. earliest">Latest vs. earliest</option></select></div></div>',d+='<div id="targetbasedvariance'+chartId+'" class="targetbasedvariance" style="display:none;text-align: center;"><div class="col-md-4"><label>Actual</label><select name="targetActual'+chartId+'"></select></div><div class="col-md-4"><label>Target/ Budget</label><select name="targetbudget'+chartId+'"></select></div><div class="col-md-4" style="display:none"><label>Forecast</label><select name="forecast'+chartId+'"></select></div></div>',d+='<div class="col-md-12 entity-selction"><p><span class="entitylabel">Entity Selection:</span><input type="radio" name="variance-top'+chartId+'" id="variance-top'+chartId+'" checked ><label for="variance-top'+chartId+'">Top</label><span id="topSpan'+chartId+'"><select name="variance-topselect'+chartId+'" id="variance-topselect'+chartId+'"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></span></p><p><input type="radio" name="variance-top'+chartId+'" id="variance-coverage'+chartId+'"><label for="variance-coverage'+chartId+'">Coverage</label> <span class="disable" id="coverageSpan'+chartId+'">0<label class="range-position"><input type="range" name="variance-range'+chartId+'" id="variance-range'+chartId+'" min="0" max="100" value="50" class="range-slide" disabled="disabled"><span class="slide-span">50</span></label>100</span></p></div>',d+="</div>",i.innerHTML=d,r.appendChild(i);let o=document.getElementById("time"+chartId),s=document.getElementById("target"+chartId),c=document.getElementById("timebasedvariance"+chartId),m=document.getElementById("targetbasedvariance"+chartId),u=document.getElementById("variance-top"+chartId),p=document.getElementById("variance-coverage"+chartId);o.addEventListener("change",function(){varianceToggle(o,c,m)}),s.addEventListener("change",function(){varianceToggle(o,c,m)}),u.addEventListener("change",toggleTimeTop),p.addEventListener("change",toggleCoverage);let y=document.querySelector("#"+l[n]+chartId+" .range-slide");y.addEventListener("change",changeRangeValue),y=y.value;let h=document.querySelector("#"+l[n]+chartId+" .slide-span");if(h.innerHTML=y,h.style.left=y-8+"%",addMeasureTargetVariance(),!a.variance){document.querySelector('input[name="variance'+chartId+'"]').checked=!1}break;case"correlations":d+='<div class="card-header '+l[n]+chartId+" "+l[n]+'"> <div class="drag-holder" style="background-image:url('+apiEndpoint+'arria/images/drag.png)"></div><input type="checkbox" name="'+l[n]+chartId+'" checked>Correlations <span>(Select at least two measures from step 1)</span><img class="card-toggle '+l[n]+chartId+" "+l[n]+'" src="data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCIgdmlld0JveD0iMCAwIDI4NC45MjkgMjg0LjkyOSIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMjg0LjkyOSAyODQuOTI5OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxnPgoJPHBhdGggZD0iTTI4Mi4wODIsNzYuNTExbC0xNC4yNzQtMTQuMjczYy0xLjkwMi0xLjkwNi00LjA5My0yLjg1Ni02LjU3LTIuODU2Yy0yLjQ3MSwwLTQuNjYxLDAuOTUtNi41NjMsMi44NTZMMTQyLjQ2NiwxNzQuNDQxICAgTDMwLjI2Miw2Mi4yNDFjLTEuOTAzLTEuOTA2LTQuMDkzLTIuODU2LTYuNTY3LTIuODU2Yy0yLjQ3NSwwLTQuNjY1LDAuOTUtNi41NjcsMi44NTZMMi44NTYsNzYuNTE1QzAuOTUsNzguNDE3LDAsODAuNjA3LDAsODMuMDgyICAgYzAsMi40NzMsMC45NTMsNC42NjMsMi44NTYsNi41NjVsMTMzLjA0MywxMzMuMDQ2YzEuOTAyLDEuOTAzLDQuMDkzLDIuODU0LDYuNTY3LDIuODU0czQuNjYxLTAuOTUxLDYuNTYyLTIuODU0TDI4Mi4wODIsODkuNjQ3ICAgYzEuOTAyLTEuOTAzLDIuODQ3LTQuMDkzLDIuODQ3LTYuNTY1QzI4NC45MjksODAuNjA3LDI4My45ODQsNzguNDE3LDI4Mi4wODIsNzYuNTExeiIgZmlsbD0iIzk4OTg5OCIvPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+Cjwvc3ZnPgo="></div>',d+='<div class="card-content">',d+='<div class="col-md-8"><p>Measures to compare:</p><div class="measure-container"><div id="measure-container'+chartId+'"></div><div class="controls"><a href="javascript:void(0);" id="addmeasure-header'+chartId+'"><img src="'+apiEndpoint+'arria/images/add.png">Add measures</a><a href="javascript:void(0);" id="removemeasure-header'+chartId+'" style="display:none"><b>-</b>Remove measures</a></div></div></div>',d+='<div class="multiple-range col-md-8"><span style="display:inline-block">Coefficient thresholds:</span>  <label style="display:inline-block"><i>0</i><span class="highlight highlight-first" style="left:24%">Low</span><span class="rangefirst slide-value slide-span" style="left:24%">0.2</span><input type="range" min="0" max="1" value="0.2" step="0.1" class="range-slide multi-range" id="low'+chartId+'"><input type="range" min="0" max="1" value="0.8" step="0.1" class="range-slide multi-range" id="strong'+chartId+'"><i style="right:-30px;">1</i><span class="highlight highlight-sencond" style="left:81%">Strong</span><span class="rangesecond slide-value slide-span" style="left:81%">0.8</span></label></div>',d+="</div>",i.innerHTML=d,r.appendChild(i);let g=document.getElementById("addmeasure-header"+chartId),v=document.getElementById("removemeasure-header"+chartId);g.addEventListener("click",addMeasureHeader),v.addEventListener("click",removeMeasureHeader);var e=document.getElementById("low"+chartId),t=document.getElementById("strong"+chartId);if(e.addEventListener("change",lowRangeChanged),t.addEventListener("change",strongRangeChanged),e.addEventListener("change",changeRangeValue),t.addEventListener("change",changeRangeValue),addMeasureHeader(),!a.correlations){document.querySelector('input[name="correlations'+chartId+'"]').checked=!1}let I=document.querySelector(".multiple-range span:first-child").clientWidth,b=document.querySelector(".multiple-range").clientWidth-I-20;document.querySelector(".multiple-range label").style.width=b+"px";let E=document.getElementsByClassName("multi-range");E[0].style.width=b+"px",E[1].style.width=b+"px";break;case"timeSeries":d+='<div class="card-header '+l[n]+chartId+" "+l[n]+'"> <div class="drag-holder" style="background-image:url('+apiEndpoint+'arria/images/drag.png)"></div><input type="checkbox" name="'+l[n]+chartId+'" checked>Time series <span>(Select at least a measure and a date time from step 1)</span><img class="card-toggle '+l[n]+chartId+" "+l[n]+'" src="data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCIgdmlld0JveD0iMCAwIDI4NC45MjkgMjg0LjkyOSIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMjg0LjkyOSAyODQuOTI5OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxnPgoJPHBhdGggZD0iTTI4Mi4wODIsNzYuNTExbC0xNC4yNzQtMTQuMjczYy0xLjkwMi0xLjkwNi00LjA5My0yLjg1Ni02LjU3LTIuODU2Yy0yLjQ3MSwwLTQuNjYxLDAuOTUtNi41NjMsMi44NTZMMTQyLjQ2NiwxNzQuNDQxICAgTDMwLjI2Miw2Mi4yNDFjLTEuOTAzLTEuOTA2LTQuMDkzLTIuODU2LTYuNTY3LTIuODU2Yy0yLjQ3NSwwLTQuNjY1LDAuOTUtNi41NjcsMi44NTZMMi44NTYsNzYuNTE1QzAuOTUsNzguNDE3LDAsODAuNjA3LDAsODMuMDgyICAgYzAsMi40NzMsMC45NTMsNC42NjMsMi44NTYsNi41NjVsMTMzLjA0MywxMzMuMDQ2YzEuOTAyLDEuOTAzLDQuMDkzLDIuODU0LDYuNTY3LDIuODU0czQuNjYxLTAuOTUxLDYuNTYyLTIuODU0TDI4Mi4wODIsODkuNjQ3ICAgYzEuOTAyLTEuOTAzLDIuODQ3LTQuMDkzLDIuODQ3LTYuNTY1QzI4NC45MjksODAuNjA3LDI4My45ODQsNzguNDE3LDI4Mi4wODIsNzYuNTExeiIgZmlsbD0iIzk4OTg5OCIvPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+Cjwvc3ZnPgo="></div>',d+='<div class="card-content text-center"><div class="col-md-8"><span>Sensitivity</span> 0 <label class="range-position"><input type="range" min="1" max="100" value="50" class="range-slide"><span class="slide-span">50</span></label>100</div></div>',i.innerHTML=d,r.appendChild(i);let w=document.querySelector("#"+l[n]+chartId+" .range-slide");w.addEventListener("change",changeRangeValue),w=w.value;let f=document.querySelector("#"+l[n]+chartId+" .slide-span");if(f.innerHTML=w,f.style.left=w-8+"%",!a.timeSeries){document.querySelector('input[name="timeSeries'+chartId+'"]').checked=!1}}if(!a[l[n]]||a[l[n]]&&n==l.length-1){if(null===document.getElementById("analysisNonDrag"+chartId)){let e=document.createElement("div");e.setAttribute("id","analysisNonDrag"+chartId),e.setAttribute("class","card nondraggable"),e.setAttribute("data-attr","nondraggable"),e.innerHTML='<div class="card-header"></div>',a[l[n]]&&n===l.length-1?r.appendChild(e):r.insertBefore(e,i)}}}listen(),cardCheckEvent(),void 0!==presistData.ootbData&&_this.initializeOOTBMetadata&&saveOOTBPersist(),"block"===pageloader.style.display&&(pageloader.style.display="none")}},n.open("POST",OOTBEndPoint+"ootb/allowedanalysis"),window.navigator.onLine?n.send(JSON.stringify(t)):showModal("You are offline. Please check that you are connected to the Internet",chartId),n.onerror=function(e){window.navigator.onLine?showModal(e,chartId):showModal("You are offline. Please check that you are connected to the Internet",chartId),pageloader.style.display="none",document.getElementById("tell-what"+chartId).innerHTML=""}}catch(e){console.log(e)}}function lowRangeChanged(){let e=document.getElementById("low"+chartId),t=document.getElementById("strong"+chartId);e.value>=t.value&&(e.value=(parseFloat(t.value)-.1).toString())}function strongRangeChanged(){let e=document.getElementById("low"+chartId),t=document.getElementById("strong"+chartId);t.value<=e.value&&(t.value=(parseFloat(e.value)+.1).toString())}function changeRangeValue(){if("100"===this.max||"10"===this.max){var e=this.nextSibling;null!==e&&(e.innerHTML=this.value,"100"===this.max?e.style.left=this.value+"%":e.style.left=10*this.value-10+"%")}else{var t=this.getAttribute("id"),a=Number(this.value);a=10*a*10;var n="",i="";t==="low"+chartId?(i=document.querySelector("#correlations"+chartId+" .highlight-first"),n=document.querySelector("#correlations"+chartId+" .rangefirst")):t=="strong"+chartId&&(i=document.querySelector("#correlations"+chartId+" .highlight-sencond"),n=document.querySelector("#correlations"+chartId+" .rangesecond")),i.style.left=a+"%",n.innerHTML=this.value,n.style.left=a+3+"%"}}function listen(){let e=document.querySelectorAll("#tell-what"+chartId+"  .card");for(let t=0;t<e.length;t++){let a=e[t].getAttribute("id"),n=document.querySelector("#"+a+" .card-header");n.removeEventListener("mouseleave",analysisRemoveEventListen),n.removeEventListener("mouseover",analysisCallDrag),n.addEventListener("mouseover",analysisCallDrag),n.addEventListener("mouseleave",analysisRemoveEventListen)}}function analysisCallDrag(){var e=document.querySelectorAll("#tell-what"+chartId+"  .card");[].forEach.call(e,analysisDragHandler)}function analysisRemoveEventListen(){var e=document.querySelectorAll("#tell-what"+chartId+"  .card");[].forEach.call(e,analysisRemoveListeningEvents)}function analysisRemoveListeningEvents(e){e.removeAttribute("draggable"),e.removeEventListener("dragstart",analysisHandleDragStart,!1),e.removeEventListener("dragenter",analysisHandleDragEnter,!1),e.removeEventListener("dragover",analysisHandleDragOver,!1),e.removeEventListener("dragleave",analysisHandleDragLeave,!1),e.removeEventListener("drop",analysisHandleDrop,!1),e.removeEventListener("dragend",analysisHandleDragEnd,!1)}showData(),window.addEventListener("offline",function(e){showModal("You are offline. Please check that you are connected to the Internet",chartId)}),advance_studio_toggle.onchange=function(){advance_studio_toggle.checked?(studioProjectEnabledFlg=!0,advance_studio_type.style.display="inline-block",describeTbl?(advanceTableBtn.checked=!0,advancedownloadJsonBtn.style.display="none",advancedownloadCsvBtn.style.display="inline-block",advanceCSVPayloadDiv.style.display="inline-block",document.getElementById("advancecustom-script"+chartId).parentElement.setAttribute("class","col-md-4 export"),document.getElementById("advancedata-json"+chartId).parentElement.setAttribute("class","col-md-4 data-json"),document.querySelector("#advancedata-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_white.png" class="arrow"><label>View Dataset in CSV</label>',advanceCheckboxContainer.style.display="block"):(advanceExportBtn.checked=!0,advancedownloadJsonBtn.style.display="inline-block",advancedownloadCsvBtn.style.display="none",advanceCSVPayloadDiv.style.display="none",document.getElementById("advancecustom-script"+chartId).parentElement.setAttribute("class","col-md-6 export"),document.getElementById("advancedata-json"+chartId).parentElement.setAttribute("class","col-md-6 data-json"),document.querySelector("#advancedata-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_white.png" class="arrow"><label>View Dataset in JSON</label>',advanceCheckboxContainer.style.display="none")):(describeTbl=!1,studioProjectEnabledFlg=!1,advance_studio_type.style.display="none",advanceExportBtn.checked=!0,advancedownloadJsonBtn.style.display="inline-block",advancedownloadCsvBtn.style.display="none",advanceCSVPayloadDiv.style.display="none",document.getElementById("advancecustom-script"+chartId).parentElement.setAttribute("class","col-md-6 export"),document.getElementById("advancedata-json"+chartId).parentElement.setAttribute("class","col-md-6 data-json"),document.querySelector("#advancedata-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_white.png" class="arrow"><label>View Dataset in JSON</label>',advanceCheckboxContainer.style.display="none"),"block"===advanceExport.style.display&&document.querySelector("#advancedata-json"+chartId+" .col-md-6:first-child img").setAttribute("src",apiEndpoint+"arria/images/arrow_up_black.png"),presistData.studioProjectEnabled=JSON.stringify(studioProjectEnabledFlg),showData(),enableOpenStudioBtn(narratorUrl_advance)},copyClipboardBtn.onclick=function(){copyChartID=chartId,copyToClipBoardFlag=!0;let e=document.getElementById("toast");document.execCommand("copy")&&(e.style.display="block",setTimeout(function(){e.style.display="none"},1e3))},document.body.addEventListener("copy",function(e){if(copyToClipBoardFlag){let t=document.getElementById("narrative-container"+copyChartID);e.clipboardData.setData("text/html",t.outerHTML),e.preventDefault(),copyToClipBoardFlag=!1}}),containerElement.addEventListener("mouseover",function(){"narrativeView"===targetElement&&"block"===narrativeSection.style.display&&("analysis"!==qlik.navigation.getMode()&&(cogWheel.style.display="block"),copyClipboardBtn.style.display="block");"edit"!==qlik.navigation.getMode()?disableContainer.style.display="none":maximize||(disableContainer.style.display="block")}),containerElement.addEventListener("mouseleave",function(){"narrativeView"===targetElement&&"block"===narrativeSection.style.display&&(cogWheel.style.display="none",copyClipboardBtn.style.display="none")}),documentBtn.onclick=function(){window.open(supportURL)},tabBoxElement.onclick=function(){$("#qlikContainer"+chartId+" header").css({"border-bottom":"2px solid #1382bc"}),tabNarrativeElement.classList.remove("active"),tabBoxElement.classList.add("active"),outofTabElement.style.display="block",narrativeTabElement.style.display="none",narrativeSection.style.display="none",targetView="ootb","block"===document.getElementById("tell-summary"+chartId).style.display?ootb_generateBtn.removeAttribute("disabled",!0):ootb_generateBtn.setAttribute("disabled",!0),presistData.targetView=targetView,targetElement="ootb",presistData.targetElement=targetElement,savePresistData(presistData)},tabNarrativeElement.onclick=function(){$("#qlikContainer"+chartId+" header").css({"border-bottom":"2px solid #1db5ac"}),void 0!==(presistData=chartObj.presistData||{})&&"{}"!==JSON.stringify(presistData)&&null!==presistData&&void 0!==presistData.projectTypeFlag&&(describeTbl=JSON.parse(presistData.projectTypeFlag||"false")),tabNarrativeElement.classList.add("active"),tabBoxElement.classList.remove("active"),outofTabElement.style.display="none",narrativeTabElement.style.display="block",narrativeSection.style.display="none",checkSliderBtn.checked?(advance_studio_toggle.checked=studioProjectEnabledFlg,advance_studio_type.style.display=studioProjectEnabledFlg?"inline-block":"none",simpleUiContainer.style.display="none",advanceUiContainer.style.display="block",simpleText.classList.remove("active"),advanceText.classList.add("active"),describeTbl||!advance_studio_toggle.checked?(advanceTableBtn.checked=!0,advancedownloadJsonBtn.style.display="none",advancedownloadCsvBtn.style.display="inline-block",advanceCSVPayloadDiv.style.display="inline-block",advanceCustomScriptElement.parentElement.setAttribute("class","col-md-4 export"),advanceDatasetJsonElement.parentElement.setAttribute("class","col-md-4 data-json"),document.querySelector("#advancedata-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_white.png" class="arrow"><label>View Dataset in CSV</label>'):(advanceExportBtn.checked=!0,advancedownloadJsonBtn.style.display="inline-block",advancedownloadCsvBtn.style.display="none",advanceCSVPayloadDiv.style.display="none",advanceCustomScriptElement.parentElement.setAttribute("class","col-md-6 export"),advanceDatasetJsonElement.parentElement.setAttribute("class","col-md-6 data-json"),document.querySelector("#advancedata-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_white.png" class="arrow"><label>View Dataset in JSON</label>'),targetView="advance"):(simpleUiContainer.style.display="block",advanceUiContainer.style.display="none",simpleText.classList.add("active"),advanceText.classList.remove("active"),describeTbl?(simpleTableBtn.checked=!0,downloadJsonBtn.style.display="none",downloadCsvBtn.style.display="inline-block",simpleCSVPayloadDiv.style.display="inline-block",advanceCustomScriptElement.parentElement.setAttribute("class","col-md-4 export"),advanceDatasetJsonElement.parentElement.setAttribute("class","col-md-4 data-json"),document.querySelector("#data-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_white.png" class="arrow"><label>View Dataset in CSV</label>'):(simpleExportBtn.checked=!0,downloadJsonBtn.style.display="inline-block",downloadCsvBtn.style.display="none",simpleCSVPayloadDiv.style.display="none",advanceCustomScriptElement.parentElement.setAttribute("class","col-md-6 export"),advanceDatasetJsonElement.parentElement.setAttribute("class","col-md-6 data-json"),document.querySelector("#data-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_white.png" class="arrow"><label>View Dataset in JSON</label>'),targetView="simple"),targetElement="generatorView",presistData.targetElement=targetElement,presistData.targetView=targetView,savePresistData(presistData)},checkSliderBtn.onchange=function(){csv_rowData=[],checkSliderBtn.checked?(simpleUiContainer.style.display="none",advanceUiContainer.style.display="block",simpleText.classList.remove("active"),advanceText.classList.add("active"),studioProjectEnabledFlg=!0,advance_studio_toggle.checked=!0,advance_studio_toggle.onchange(),describeTbl&&advance_studio_toggle.checked?(advanceTableBtn.checked=!0,advancedownloadJsonBtn.style.display="none",advancedownloadCsvBtn.style.display="inline-block",advanceCSVPayloadDiv.style.display="inline-block",advanceCustomScriptElement.parentElement.setAttribute("class","col-md-4 export"),advanceDatasetJsonElement.parentElement.setAttribute("class","col-md-4 data-json"),document.querySelector("#advancedata-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_white.png" class="arrow"><label>View Dataset in CSV</label>',advanceCheckboxContainer.style.display="block",autoIncrementID=!!advanceIncrementBtn.checked):(describeTbl=!1,advanceExportBtn.checked=!0,advancedownloadJsonBtn.style.display="inline-block",advancedownloadCsvBtn.style.display="none",advanceCSVPayloadDiv.style.display="none",advanceCustomScriptElement.parentElement.setAttribute("class","col-md-6 export"),advanceDatasetJsonElement.parentElement.setAttribute("class","col-md-6 data-json"),document.querySelector("#advancedata-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_white.png" class="arrow"><label>View Dataset in JSON</label>'),targetView="advance",enableOpenStudioBtn(narratorUrl_advance)):(simpleUiContainer.style.display="block",advanceUiContainer.style.display="none",simpleText.classList.add("active"),advanceText.classList.remove("active"),describeTbl?(simpleTableBtn.checked=!0,downloadJsonBtn.style.display="none",downloadCsvBtn.style.display="inline-block",simpleCSVPayloadDiv.style.display="inline-block",customScriptElement.parentElement.setAttribute("class","col-md-4 export"),datasetJsonElement.parentElement.setAttribute("class","col-md-4 data-json"),document.querySelector("#data-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_white.png" class="arrow"><label>View Dataset in CSV</label>',simpleCheckboxContainer.style.display="block",autoIncrementID=!!simpleIncrementBtn.checked):(simpleExportBtn.checked=!0,downloadJsonBtn.style.display="inline-block",downloadCsvBtn.style.display="none",simpleCSVPayloadDiv.style.display="none",customScriptElement.parentElement.setAttribute("class","col-md-6 export"),datasetJsonElement.parentElement.setAttribute("class","col-md-6 data-json"),document.querySelector("#data-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_white.png" class="arrow"><label>View Dataset in JSON</label>'),targetView="simple",enableOpenStudioBtn(narratorUrl)),showData(),targetElement="generatorView",presistData.targetElement=targetElement,presistData.targetView=targetView,presistData.projectTypeFlag=JSON.stringify(describeTbl),savePresistData(presistData)},datasetJsonElement.onclick=function(e){let t=document.querySelector("#data-json"+chartId+" .col-md-6:first-child img");("A"!==e.target.tagName&&"IMG"!==e.target.tagName||"arrow"===e.target.className)&&("block"===simpleExport.style.display?(simpleExport.style.display="none",datasetJsonElement.classList.remove("active"),t.setAttribute("src",apiEndpoint+"arria/images/arrow_white.png"),"inline-block"===downloadJsonBtn.style.display?document.querySelector("#download-json"+chartId+" img").setAttribute("src",apiEndpoint+"arria/images/download_white.png"):document.querySelector("#download-csv"+chartId+" img").setAttribute("src",apiEndpoint+"arria/images/download_white.png")):(simpleExport.style.display="block",datasetJsonElement.classList.add("active"),t.setAttribute("src",apiEndpoint+"arria/images/arrow_up_black.png"),"inline-block"===downloadJsonBtn.style.display?document.querySelector("#download-json"+chartId+" img").setAttribute("src",apiEndpoint+"arria/images/download_white.png"):document.querySelector("#download-csv"+chartId+" img").setAttribute("src",apiEndpoint+"arria/images/download_white.png")))},customScriptElement.onclick=function(){let e=document.getElementById("arrow-script"+chartId);"block"===scriptInputSimpleElement.style.display?(scriptInputSimpleElement.style.display="none",customScriptElement.classList.remove("active"),e.setAttribute("src",apiEndpoint+"arria/images/arrow_white.png")):(scriptInputSimpleElement.style.display="block",customScriptElement.classList.add("active"),e.setAttribute("src",apiEndpoint+"arria/images/arrow_up_black.png"))},simpleTableBtn.onchange=function(){downloadJsonBtn.style.display="none",downloadCsvBtn.style.display="inline-block",simpleCSVPayloadDiv.style.display="inline-block",customScriptElement.parentElement.setAttribute("class","col-md-4 export"),datasetJsonElement.parentElement.setAttribute("class","col-md-4 data-json"),describeTbl=!0,"block"===simpleExport.style.display?(document.querySelector("#download-csv"+chartId+" img").setAttribute("src",apiEndpoint+"arria/images/download_white.png"),document.querySelector("#data-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_up_black.png"><label>View Dataset in CSV</label>'):(document.querySelector("#download-csv"+chartId+" img").setAttribute("src",apiEndpoint+"arria/images/download_white.png"),document.querySelector("#data-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_white.png"><label>View Dataset in CSV</label>'),simpleCheckboxContainer.style.display="block",showData()},simpleExportBtn.onchange=function(){simpleCheckboxContainer.style.display="none",simpleJsonDataView(),showData()},downloadJsonBtn.onclick=function(){downloadJSON_Data()},downloadCsvBtn.onclick=function(){downloadCSV_Data()},cogWheel.onclick=function(){if("narrativeView"===targetElement&&"block"===narrativeSection.style.display){if(headerSection.style.display="block",narrativeSection.style.display="none",void 0!==presistData.targetView)if("ootb"===(targetView=presistData.targetView)){narrativeTabElement.style.display="none",outofTabElement.style.display="block";let e=tellSummaryContainer,t=document.querySelector("#outofbox-tabsection"+chartId+" .generate_btn");"block"===e.style.display&&t.removeAttribute("disabled")}else narrativeTabElement.style.display="block",outofTabElement.style.display="none",checkSliderBtn.checked="simple"!==targetView;initialViewVisibility(),targetElement="generatorView",presistData.targetElement=targetElement,presistData.targetView=targetView,savePresistData(presistData)}},generateSimpleNarrative.onclick=function(){window.navigator.onLine?generateNarrative():showModal("You are offline. Please check that you are connected to the Internet",chartId)},narratorUrl.onkeyup=function(){enableOpenStudioBtn(narratorUrl)},narratorUrl_advance.onkeyup=function(){enableOpenStudioBtn(narratorUrl_advance)},openStudioBtn.onclick=function(){var e=narratorUrl.value;checkSliderBtn.checked&&(e=narratorUrl_advance.value);var t=extractHostname(e),a="https://<hostName>/design/<projectKey>/composer",n=e.split("/").splice(-1);a=(a=a.replace("<projectKey>",n)).replace("<hostName>",t),window.open(a)},closeModalBtn.onclick=function(){document.getElementById("closemodal"+chartId).style.marginBottom="0px",document.getElementById("modal"+chartId).style.display="none"},insightAccordianBtn.onclick=function(){"none"===insightAccordian.style.display?(insightAccordian.style.display="block",insightAccordianBtn.classList.add("active"),document.querySelector("#advance-mode"+chartId+" .insight-accordian img").setAttribute("src",apiEndpoint+"arria/images/arrow_up.png")):(insightAccordian.style.display="none",insightAccordianBtn.classList.remove("active"),document.querySelector("#advance-mode"+chartId+" .insight-accordian img").setAttribute("src",apiEndpoint+"arria/images/arrow_white.png"))},wrapperAccordianBtn.onclick=function(){"none"===wrapperAccordian.style.display?(wrapperAccordian.style.display="block",wrapperAccordianBtn.classList.add("active"),document.querySelector("#advance-mode"+chartId+" .wrapper-accordian img").setAttribute("src",apiEndpoint+"arria/images/arrow_up.png")):(wrapperAccordian.style.display="none",wrapperAccordianBtn.classList.remove("active"),document.querySelector("#advance-mode"+chartId+" .wrapper-accordian img").setAttribute("src",apiEndpoint+"arria/images/arrow_white.png"))},addDynamicHeaderBtn.onclick=function(){let e=document.querySelector("#advance-mode"+chartId+" .dynamic-header .append-container").childElementCount;nlgHeaderDynamicElCount=e+1,nlgHeaderDynamicElCount+=chartId;let t=document.createElement("div");t.setAttribute("class","col-md-12 auth-header");let a='<div class="col-md-4"><input type="text" placeholder="Key" id=nlg_authKey_'+nlgHeaderDynamicElCount+'></div><div class="col-md-8"><input type="text" placeholder="Value" id=nlg_authValue_'+nlgHeaderDynamicElCount+"></div>";t.innerHTML=a,document.querySelector("#advance-mode"+chartId+" .dynamic-header .append-container").appendChild(t),removeDynamicHeaderBtn.style.display="inline"},addInsightHeaderBtn.onclick=function(){let e=document.querySelector("#advance-mode"+chartId+" .insight-content .append-container").childElementCount;insightsHeaderDynamicElCount=e+1,insightsHeaderDynamicElCount+=chartId;let t=document.createElement("div");t.setAttribute("class","col-md-12 auth-header");let a='<div class="col-md-4"><input type="text" placeholder="Key" id=insights_authKey_'+insightsHeaderDynamicElCount+'></div><div class="col-md-8"><input type="text" placeholder="Value" id=insights_authValue_'+insightsHeaderDynamicElCount+"></div>";t.innerHTML=a,document.querySelector("#advance-mode"+chartId+" .insight-content .append-container").appendChild(t),removeInsightHeaderBtn.style.display="inline"},addWrapperHeaderBtn.onclick=function(){let e=document.querySelector("#advance-mode"+chartId+" .wrapper-content .append-container").childElementCount;wrapperHeaderDynamicElCount=e+1,wrapperHeaderDynamicElCount+=chartId;let t=document.createElement("div");t.setAttribute("class","col-md-12 auth-header");let a='<div class="col-md-4"><input type="text" placeholder="Key" id=wrapper_authKey_'+wrapperHeaderDynamicElCount+'></div><div class="col-md-8"><input type="text" placeholder="Value" id=wrapper_authValue_'+wrapperHeaderDynamicElCount+"></div>";t.innerHTML=a,document.querySelector("#advance-mode"+chartId+" .wrapper-content .append-container").appendChild(t),removeWrapperHeaderBtn.style.display="inline"},advanceTableBtn.onchange=function(){advancedownloadJsonBtn.style.display="none",advancedownloadCsvBtn.style.display="inline-block",advanceCSVPayloadDiv.style.display="inline-block",advanceCustomScriptElement.parentElement.setAttribute("class","col-md-4 export"),advanceDatasetJsonElement.parentElement.setAttribute("class","col-md-4 data-json"),describeTbl=!0,"block"===advanceExport.style.display?(document.querySelector("#advancedownload-csv"+chartId+" img").setAttribute("src",apiEndpoint+"arria/images/download_white.png"),document.querySelector("#advancedata-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_up_black.png"><label>View Dataset in CSV</label>'):(document.querySelector("#advancedownload-csv"+chartId+" img").setAttribute("src",apiEndpoint+"arria/images/download_white.png"),document.querySelector("#advancedata-json"+chartId+" .col-md-6").innerHTML='<img src="'+apiEndpoint+'arria/images/arrow_white.png"><label>View Dataset in CSV</label>'),advanceCheckboxContainer.style.display="block",showData()},advanceExportBtn.onchange=function(){advanceCheckboxContainer.style.display="none",advanceJsonDataView(),showData()},advancedownloadJsonBtn.onclick=function(){downloadJSON_Data()},advancedownloadCsvBtn.onclick=function(){downloadCSV_Data()},advanceDatasetJsonElement.onclick=function(e){let t=document.querySelector("#advancedata-json"+chartId+" .col-md-6:first-child img");("A"!==e.target.tagName&&"IMG"!==e.target.tagName||"arrow"===e.target.className)&&("block"===advanceExport.style.display?(advanceExport.style.display="none",advanceDatasetJsonElement.classList.remove("active"),t.setAttribute("src",apiEndpoint+"arria/images/arrow_white.png"),"inline-block"===advancedownloadJsonBtn.style.display?document.querySelector("#advancedownload-json"+chartId+" img").setAttribute("src",apiEndpoint+"arria/images/download_white.png"):document.querySelector("#advancedownload-csv"+chartId+" img").setAttribute("src",apiEndpoint+"arria/images/download_white.png")):(advanceExport.style.display="block",advanceDatasetJsonElement.classList.add("active"),t.setAttribute("src",apiEndpoint+"arria/images/arrow_up_black.png"),"inline-block"===advancedownloadJsonBtn.style.display?document.querySelector("#advancedownload-json"+chartId+" img").setAttribute("src",apiEndpoint+"arria/images/download_white.png"):document.querySelector("#advancedownload-csv"+chartId+" img").setAttribute("src",apiEndpoint+"arria/images/download_white.png")))},advanceCustomScriptElement.onclick=function(){let e=document.querySelector("#advancecustom-script"+chartId+" img");"block"===advanceScriptInputSimpleElement.style.display?(advanceScriptInputSimpleElement.style.display="none",advanceCustomScriptElement.classList.remove("active"),e.setAttribute("src",apiEndpoint+"arria/images/arrow_white.png")):(advanceScriptInputSimpleElement.style.display="block",advanceCustomScriptElement.classList.add("active"),e.setAttribute("src",apiEndpoint+"arria/images/arrow_up_black.png"))},removeDynamicHeaderBtn.onclick=function(){let e=document.querySelector("#advance-mode"+chartId+" .dynamic-header .append-container").childElementCount,t=document.querySelector("#advance-mode"+chartId+" .dynamic-header .append-container .auth-header:last-child");e>=1&&t.parentNode.removeChild(t),1!==e&&0!==e||(removeDynamicHeaderBtn.style.display="none")},removeInsightHeaderBtn.onclick=function(){let e=document.querySelector("#advance-mode"+chartId+" .insight-content .append-container").childElementCount,t=document.querySelector("#advance-mode"+chartId+" .insight-content .append-container .auth-header:last-child");e>=1&&t.parentNode.removeChild(t),1!==e&&0!==e||(removeInsightHeaderBtn.style.display="none")},removeWrapperHeaderBtn.onclick=function(){let e=document.querySelector("#advance-mode"+chartId+" .wrapper-content .append-container").childElementCount,t=document.querySelector("#advance-mode"+chartId+" .wrapper-content .append-container .auth-header:last-child");e>=1&&t.parentNode.removeChild(t),1!==e&&0!==e||(removeWrapperHeaderBtn.style.display="none")},simpleCSVPayload.onclick=function(){let e=document.querySelector("#csv-payload"+chartId+" img");"block"===simpleCSVContainer.style.display?(simpleCSVContainer.style.display="none",simpleCSVPayload.classList.remove("active"),e.setAttribute("src",apiEndpoint+"arria/images/arrow_white.png")):(simpleCSVContainer.style.display="block",simpleCSVPayload.classList.add("active"),e.setAttribute("src",apiEndpoint+"arria/images/arrow_up_black.png"))},advanceCSVPayload.onclick=function(){let e=document.querySelector("#advance-csvpayload"+chartId+" img");"block"===advanceCSVContainer.style.display?(advanceCSVContainer.style.display="none",advanceCSVPayload.classList.remove("active"),e.setAttribute("src",apiEndpoint+"arria/images/arrow_white.png")):(advanceCSVContainer.style.display="block",advanceCSVPayload.classList.add("active"),e.setAttribute("src",apiEndpoint+"arria/images/arrow_up_black.png"))},document.body.onclick=function(e){if("narrativeView"===targetElement){if("dropdown"!==e.target.className){let e=document.querySelectorAll(".drop-select");for(let t=0;t<e.length;t++)e[t].style.display="none"}}else{let t=e.target.className.split(" ");if(void 0!==t[2]&&null!==t[2]||(t[2]=""),(e.target.className==="card-header "+t[1]||e.target.className==="card-toggle "+t[1]||e.target.className==="card-header "+t[1]+" "+t[2]||e.target.className==="card-toggle "+t[1]+" "+t[2])&&-1===t[1].indexOf("accordian-summary")&&-1===t[1].indexOf("accordian-thing")&&-1===t[1].indexOf("accordian-everything")){let e=document.getElementById(t[1]);-1!==JSON.stringify(e.classList).indexOf("active")?e.classList.remove("active"):e.classList.add("active")}}},ootb_generateBtn.onclick=function(){if(!window.navigator.onLine)return void showModal("You are offline. Please check that you are connected to the Internet",chartId);document.getElementById("pageloader"+chartId).style.display="block",generateBtnClicked=!0,generateOOTBNarrative(),presistOrderColumns()},disableContainer.addEventListener("click",function(){"none"==document.getElementById("modal"+chartId).style.display&&(document.getElementById("closemodal"+chartId).style.marginBottom="40px",showModal("<img class='resize-disable' src='"+apiEndpoint+"arria/images/qs_max_icon.png'> Please use the maximised view for configuration",chartId))}),simpleIncrementBtn.onchange=function(){autoIncrementID=!!this.checked,presistSimplecheck={view:"simple",check:autoIncrementID},showData()},advanceIncrementBtn.onchange=function(){autoIncrementID=!!this.checked,presistAdvanceCheck={view:"advance",check:autoIncrementID},showData()},nextBtn.onclick=function(){if(!window.navigator.onLine)return void showModal("You are offline. Please check that you are connected to the Internet",chartId);let e=document.querySelector("#outofbox-tabsection"+chartId+" .slide ul li.active");prevoiusBtn.style.display="block",e.classList.remove("active"),e.nextSibling.classList.add("active"),"block"===tellmedataContainer.style.display?(tellmedataContainer.style.display="none",tellWhatContainer.style.display="block",sliderContent.innerHTML="2. Tell me what you want to say",getOOTBMetadata(),ootb_generateBtn.setAttribute("disabled",!0)):"block"===tellWhatContainer.style.display&&(tellWhatContainer.style.display="none",tellSummaryContainer.style.display="block",nextBtn.style.display="none",sliderContent.innerHTML="3. Tell me how to say it",ootb_generateBtn.setAttribute("disabled",!0),(summaryCheckBtn.checked||keyInsightsCheckBtn.checked||everythingCheckBtn.checked)&&(ootb_generateBtn.removeAttribute("disabled",!0),summaryCheckBtn.checked?generateSummaryText("summary"):keyInsightsCheckBtn.checked?generateSummaryText("keyInsights"):everythingCheckBtn.checked&&generateSummaryText("everything")),void 0===analysisMetadata&&getOOTBMetadata())},prevoiusBtn.onclick=function(){if(!window.navigator.onLine)return void showModal("You are offline. Please check that you are connected to the Internet",chartId);ootb_generateBtn.setAttribute("disabled",!0);let e=document.querySelector("#outofbox-tabsection"+chartId+" .slide ul li.active");e.classList.remove("active"),e.previousSibling.classList.add("active"),"block"===tellWhatContainer.style.display?(tellmedataContainer.style.display="block",tellWhatContainer.style.display="none",prevoiusBtn.style.display="none",sliderContent.innerHTML="1. Tell me about your data"):"block"===tellSummaryContainer.style.display&&(tellSummaryContainer.style.display="none",tellWhatContainer.style.display="block",nextBtn.style.display="block",sliderContent.innerHTML="2. Tell me what you want to say",getOOTBMetadata())},slideDotOne.onclick=function(){let e=document.querySelector(".slide ul li.active");prevoiusBtn.style.display="none",nextBtn.style.display="block",e.classList.remove("active"),slideDotOne.classList.add("active"),tellmedataContainer.style.display="block",tellWhatContainer.style.display="none",tellSummaryContainer.style.display="none",sliderContent.innerHTML="1. Tell me about your data",ootb_generateBtn.setAttribute("disabled",!0)},slideDotTwo.onclick=function(){let e=document.querySelector(".slide ul li.active");prevoiusBtn.style.display="block",nextBtn.style.display="block",e.classList.remove("active"),slideDotTwo.classList.add("active"),tellmedataContainer.style.display="none",tellWhatContainer.style.display="block",tellSummaryContainer.style.display="none",sliderContent.innerHTML="2. Tell me what you want to say",ootb_generateBtn.setAttribute("disabled",!0),getOOTBMetadata()},slideDotThree.onclick=function(){let e=document.querySelector(".slide ul li.active");prevoiusBtn.style.display="block",nextBtn.style.display="none",e.classList.remove("active"),slideDotThree.classList.add("active"),tellmedataContainer.style.display="none",tellWhatContainer.style.display="none",tellSummaryContainer.style.display="block",sliderContent.innerHTML="3. Tell me how to say it",ootb_generateBtn.setAttribute("disabled",!0),(summaryCheckBtn.checked||keyInsightsCheckBtn.checked||everythingCheckBtn.checked)&&(ootb_generateBtn.removeAttribute("disabled",!0),summaryCheckBtn.checked?generateSummaryText("summary"):keyInsightsCheckBtn.checked?generateSummaryText("keyInsights"):everythingCheckBtn.checked&&generateSummaryText("everything")),void 0===analysisMetadata&&getOOTBMetadata()};var analysisSrcElement=null;function analysisHandleDragStart(e){analysisSrcElement=this,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",this.outerHTML),this.classList.add("dragElem")}function analysisHandleDragOver(e){return e.preventDefault&&e.preventDefault(),this.classList.add("over"),e.dataTransfer.dropEffect="move",!1}function analysisHandleDragEnter(e){}function analysisHandleDragLeave(e){this.classList.remove("over")}function analysisHandleDrop(e){if(e.stopPropagation&&e.stopPropagation(),analysisSrcElement!=this){let l=analysisSrcElement.getAttribute("id");if(l==="stats"+chartId){let e=document.getElementById("rank-data"+chartId),t=document.getElementById("analysis"+chartId);e=e.checked?"Data":"Domain";let a=document.querySelector('input[name="stats'+chartId+'"]');a=a.checked,saveDragStatics(e,t=t.checked,a)}else if(l==="distribution"+chartId){let e=document.querySelector("#distribution"+chartId+"  .range-slide");saveDragDistribution(e=e.value)}else if(l==="variance"+chartId){let e=document.getElementById("time"+chartId);e=e.checked;let t=document.getElementById("timeperiod"+chartId),a=document.getElementById("timeComparrison"+chartId),n=document.getElementById("variance-top"+chartId),i=(document.getElementById("variance-coverage"+chartId),document.getElementById("variance-topselect"+chartId)),l=document.querySelector('select[name="targetActual'+chartId+'"]'),r=document.querySelector('select[name="targetbudget'+chartId+'"]'),d=document.getElementById("variance-range"+chartId);e?(e="time",t=t.value,a=a.value,l=null,r=null):(e="target",t=null,a=null,l=l.value,r=r.value),n.checked?(n="Top",i=i.value,d=null):(n="Coverage",i=null,d="50"!==d.value?d.value:"");let o=document.querySelector('input[name="variance'+chartId+'"]');saveDragVariance(e,t,a,l,r,n,i,d,o=o.checked)}else if(l==="correlations"+chartId){var t=document.getElementById("low"+chartId);t=t.value;var a=document.getElementById("strong"+chartId);a=a.value;let e=document.querySelector('input[name="correlations'+chartId+'"]');saveDragCorrelation(t,a,e=e.checked)}else if(l==="timeSeries"+chartId){var n=document.querySelector("#timeSeries"+chartId+' input[type="range"]');n=n.value;let e=document.querySelector('input[name="timeSeries'+chartId+'"]');saveDragtimeSeries(n,e=e.checked)}this.parentNode.removeChild(analysisSrcElement);var i=e.dataTransfer.getData("text/html");this.insertAdjacentHTML("beforebegin",i),analysisDragHandler(this.previousSibling),listen(),analysisRemoveEventListen(),cardCheckEvent()}return this.classList.remove("over"),!1}function analysisHandleDragEnd(e){this.classList.remove("over")}function analysisDragHandler(e){e.setAttribute("draggable","true"),e.addEventListener("dragstart",analysisHandleDragStart,!1),e.addEventListener("dragenter",analysisHandleDragEnter,!1),e.addEventListener("dragover",analysisHandleDragOver,!1),e.addEventListener("dragleave",analysisHandleDragLeave,!1),e.addEventListener("drop",analysisHandleDrop,!1),e.addEventListener("dragend",analysisHandleDragEnd,!1)}function saveDragStatics(e,t,a){("Data"!==e||t)&&setTimeout(function(){let n=document.getElementById("rank-domain"+chartId),i=document.getElementById("rank-data"+chartId),l=document.getElementById("analysis"+chartId);"Data"==e?(i.checked=!0,n.checked=!1):(n.checked=!0,i.checked=!1),t&&(l.checked=!0),document.querySelector('input[name="stats'+chartId+'"]').checked=a},0)}function saveDragDistribution(e){setTimeout(function(){document.querySelector("#distribution"+chartId+"  .range-slide").value=e},500)}function saveDragVariance(e,t,a,n,i,l,r,d,o){setTimeout(function(){if(document.querySelector('input[name="variance'+chartId+'"]').checked=o,"time"===e){if(document.getElementById("time"+chartId).checked=!0,null!==t&&""!==t){document.getElementById("timeperiod"+chartId).value=t}if(null!==a&&""!==a){document.getElementById("timeComparrison"+chartId).value=a}}else{if(document.getElementById("target"+chartId).checked=!0,null!==n&&""!==n){document.querySelector('select[name="targetActual'+chartId+'"]').value=n}if(null!==i&&""!==i){document.querySelector('select[name="targetbudget'+chartId+'"]').value=i}}let s=document.getElementById("variance-range"+chartId);if(s.addEventListener("change",changeRangeValue),"Coverage"===l){document.getElementById("variance-coverage"+chartId).checked=!0,null!==d&&""!==d&&(s.value=d)}else{if(document.getElementById("variance-top"+chartId).checked=!0,null!==r){document.getElementById("variance-topselect"+chartId).value=r}}let c=document.getElementById("time"+chartId),m=document.getElementById("target"+chartId),u=document.getElementById("timebasedvariance"+chartId),p=document.getElementById("targetbasedvariance"+chartId),y=document.getElementById("variance-top"+chartId),h=document.getElementById("variance-coverage"+chartId);c.addEventListener("change",function(){varianceToggle(c,u,p)}),m.addEventListener("change",function(){varianceToggle(c,u,p)}),y.addEventListener("change",toggleTimeTop),h.addEventListener("change",toggleCoverage)},0)}function saveDragCorrelation(e,t,a){setTimeout(function(){document.querySelector('input[name="correlations'+chartId+'"]').checked=a;let n=document.getElementById("addmeasure-header"+chartId),i=document.getElementById("removemeasure-header"+chartId);n.addEventListener("click",addMeasureHeader),i.addEventListener("click",removeMeasureHeader);var l=document.getElementById("low"+chartId);l.addEventListener("change",lowRangeChanged);var r=document.getElementById("strong"+chartId);l.addEventListener("change",changeRangeValue),l.value=e,r.addEventListener("change",strongRangeChanged),r.addEventListener("change",changeRangeValue),r.value=t},0)}function saveDragtimeSeries(e,t){setTimeout(function(){document.querySelector('input[name="timeSeries'+chartId+'"]').checked=t;var a=document.querySelector("#timeSeries"+chartId+' input[type="range"]');a.addEventListener("change",changeRangeValue),a.value=e},0)}function cardCheckEvent(){var e=document.querySelectorAll("#tell-what"+chartId+" .card .card-header input");[].forEach.call(e,cardHeaderEventListener)}function cardHeaderEventListener(e){e.addEventListener("change",analysisToggleEvent)}function analysisToggleEvent(){this.checked?this.parentElement.parentElement.classList.add("active"):this.parentElement.parentElement.classList.remove("active")}function generateSummaryText(e){let t=[],a=document.getElementById("pageloader"+chartId);if("block"==document.getElementById("tell-summary"+chartId).style.display&&(a.style.display="block"),void 0!=analysisMetadata||null!=analysisMetadata){let e=document.querySelectorAll("#tell-what"+chartId+"  .card");for(let a=0;a<e.length;a++){let n=e[a].getAttribute("id");if(n==="stats"+chartId){let e=document.querySelector('input[name="stats'+chartId+'"]');if(analysisMetadata.stats&&e.checked){t.push({analysisType:"descriptiveStats",rank:t.length+1});let e=document.getElementById("rank-domain"+chartId),a=document.getElementById("analysis"+chartId);e.checked?t[t.length-1].ranking="domain":t[t.length-1].ranking="data",a.checked?t[t.length-1].distribution_analysis=!0:t[t.length-1].distribution_analysis=!1}}else if(n==="correlations"+chartId){if(analysisMetadata.correlations){if(document.querySelector('input[name="correlations'+chartId+'"]').checked){let e=document.querySelectorAll("#measure-container"+chartId+"  .measure");t.push({analysisType:"correlations",rank:t.length+1});let a=[];for(let t=0;t<e.length;t++){let n=e[t].getAttribute("id"),i=document.querySelector("#"+n+" select:first-child"),l=document.querySelector("#"+n+" select:last-child");a.push([i.value,l.value])}t[t.length-1].measures=a;let n=document.getElementById("low"+chartId),i=document.getElementById("strong"+chartId);t[t.length-1].thresholds={low:n.value,strong:i.value}}}}else if(n==="variance"+chartId){if(analysisMetadata.variance){if(document.querySelector('input[name="variance'+chartId+'"]').checked){if(t.push({analysisType:"varianceAnalysis",rank:t.length+1}),document.getElementById("time"+chartId).checked){let e=document.getElementById("timeperiod"+chartId),a=document.getElementById("timeComparrison"+chartId),n=document.getElementById("target-measure"+chartId);t[t.length-1].varianceType="timeBased",t[t.length-1].measure=n.value,t[t.length-1].Period=e.value,t[t.length-1].comparison=a.value}else{let e=document.querySelector('select[name="targetActual'+chartId+'"]'),a=document.querySelector('select[name="targetbudget'+chartId+'"]');t[t.length-1].varianceType="targetBased",t[t.length-1].actual=e.value,t[t.length-1].target=a.value}let e="";if(document.getElementById("variance-top"+chartId).checked){e=document.getElementById("variance-topselect"+chartId).value,t[t.length-1].entitySelection={topN:e}}else{e=document.getElementById("variance-range"+chartId).value+"%",t[t.length-1].entitySelection={coverage:e}}}}}else if(n==="timeSeries"+chartId&&analysisMetadata.timeSeries){if(document.querySelector('input[name="timeSeries'+chartId+'"]').checked){let e=document.querySelector("#timeSeries"+chartId+' input[type="range"]');t.push({analysisType:"timeSeriesAnalysis",rank:t.length+1,sensitivity:e.value})}}}}let n=document.getElementById("summary"+chartId),i=document.getElementById("keyInsights"+chartId),l=document.getElementById("everything"+chartId),r=[];n.checked&&(r=[{verbosity:"summary"}]),i.checked&&(r=[{verbosity:"keyInsights"}]),l.checked&&(r=[{verbosity:"everything"}]);var d={narrativeConfigMetaData:{characterization:[],analysisOrchestration:[],generation:[]}};void 0!==presistData.ootbModel&&(d=JSON.parse(presistData.ootbModel)),0===dimensionCharacterization.length||""===dimensionCharacterization?(ootbModel.narrativeConfigMetaData.characterization=d.narrativeConfigMetaData.characterization,dimensionCharacterization=ootbModel.narrativeConfigMetaData.characterization):ootbModel.narrativeConfigMetaData.characterization=dimensionCharacterization,ootbModel.narrativeConfigMetaData.analysisOrchestration=t,ootbModel.narrativeConfigMetaData.generation=r;let o=dataModel;o.dataset[0].metadata=ootbModel;let s=new XMLHttpRequest;s.onreadystatechange=function(){if(4===this.readyState&&200===this.status&&""!==s.responseText){a.style.display="none";let e=document.getElementById("accordian-summary"+chartId),t="";t=(t=s.responseText).trim();try{t=JSON.parse(t)}catch(e){}document.querySelector("#accordian-summary"+chartId+"  .card-content .ootb-text").innerHTML=t,e.classList.add("active")}},s.onerror=function(e){window.navigator.onLine?showModal(e,chartId):showModal("You are offline. Please check that you are connected to the Internet",chartId),a.style.display="none"},s.open("POST",OOTBGenerateEndPoint,!0),s.setRequestHeader("x-api-key",OOTBEndPointAPIKey),window.navigator.onLine?s.send(JSON.stringify(o)):showModal("You are offline. Please check that you are connected to the Internet",chartId)}function initializeOOTB(){try{var e=chartObj.presistData.ootbData;if(void 0!=e){let t=JSON.parse(e);if(void 0!=t.narrativeConfigMetaData.generation||""!=t.narrativeConfigMetaData.generation){let e=t.narrativeConfigMetaData.generation;void 0===e&&(e=[{verbosity:"summary"}]);let a=document.getElementById("summary"+chartId),n=document.getElementById("keyInsights"+chartId),i=document.getElementById("everything"+chartId);try{"summary"===e[0].verbosity?a.checked=!0:"keyInsights"===e[0].verbosity?n.checked=!0:"everything"==e[0].verbosity&&(i.checked=!0)}catch(e){console.log(e)}}void 0==t.narrativeConfigMetaData.characterization&&""==t.narrativeConfigMetaData.characterization||setTimeout(function(){let e=t.narrativeConfigMetaData.characterization,a=document.querySelectorAll("#tell-data"+chartId+" .card");for(let t=0;t<e.length;t++)for(let n=0;n<a.length;n++){if(a[n].getAttribute("data-attr")==e[t].attributeName){let i=a[n].getAttribute("data-id")+chartId,l=document.querySelector('input[name="field'+i+'"]');null!=l&&(l.checked=!0),document.querySelector('input[name="alias'+i+'"]').value=e[t].alias;let r=document.querySelector('input[name="dimension'+i+'"]'),d=document.querySelector('input[name="measure'+i+'"]');if("dimension"==e[t].attributeType){r.checked=!0,d.checked=!1;let e=document.getElementById("measure-container"+i),t=document.getElementById("increase-container"+i);null!=t&&(t.style.display="none"),null!=e&&(e.style.display="none");let a=document.querySelector("#content"+i+" .measure-list");a.classList.add("text-center"),a.classList.remove("text-left")}else{if(d.checked=!0,r.checked=!1,"bad"==e[t].increase){document.getElementById("bad"+i).checked=!0}else if("neutral"==e[t].increase){document.getElementById("neutral"+i).checked=!0}document.querySelector('input[name="unit'+i+'"]').value=e[t].unit;let a=document.getElementById("measure-container"+i);null!=a&&(a.style.display="inline-block");let n=document.querySelector("#increase-container"+i);null!=n&&(n.style.display="inline-block");let l=document.querySelector("#content"+i+" .measure-list");l.classList.add("text-left"),l.classList.remove("text-center")}setTimeout(function(){let a=document.getElementById("select-entity"+i);null!=a&&(a.value=e[t].entityType)},1e3)}}},1e3),void 0==t.narrativeConfigMetaData.characterization&&""==t.narrativeConfigMetaData.characterization||(_this.initializeOOTBMetadata=!0)}}catch(e){console.log(e)}}function saveOOTBPersist(){var e=chartObj.presistData.ootbData;if(void 0!=e){_this.initializeOOTBMetadata=!1;let t=JSON.parse(e).narrativeConfigMetaData.analysisOrchestration;if(void 0!=t||""!=t)if(t.length>0){let e={};for(let a=0;a<t.length;a++){if("descriptiveStats"==t[a].analysisType){e.descriptiveStats=!0;let n=document.getElementById("rank-data"+chartId),i=document.getElementById("rank-domain"+chartId);"domain"==t[a].ranking?null!=i&&(i.checked=!0,n.checked=!1):(n.checked=!0,i.checked=!1);let l=document.getElementById("analysis"+chartId);null!=l&&(l.checked=t[a].distribution_analysis)}else if("varianceAnalysis"==t[a].analysisType){e.varianceAnalysis=!0;let n=document.getElementById("timebasedvariance"+chartId),i=document.getElementById("targetbasedvariance"+chartId);if("targetBased"==t[a].varianceType){document.getElementById("target"+chartId).checked=!0,n.style.display="none",i.style.display="block",setTimeout(function(){let e=document.querySelector('select[name="targetActual'+chartId+'"]');$('select[name="targetActual"] option[value="'+t[a].actual+'"]').length>0&&(e.value=t[a].actual);let n=document.querySelector('select[name="targetbudget'+chartId+'"]');$('select[name="targetbudget'+chartId+'"] option[value="'+t[a].target+'"]').length>0&&(n.value=t[a].target);let i=document.querySelector('select[name="forecast'+chartId+'"]');$('select[name="forecast'+chartId+'"] option[value="'+t[a].forcast+'"]').length>0&&(i.value=t[a].forcast)},500)}else{document.getElementById("time"+chartId).checked=!0,n.style.display="block",i.style.display="none",document.getElementById("timeperiod"+chartId).value=t[a].Period,document.getElementById("timeComparrison"+chartId).value=t[a].comparison,setTimeout(function(){let e=document.getElementById("target-measure"+chartId);$("#target-measure"+chartId+'  option[value="'+t[a].measure+'"]').length>0&&(e.value=t[a].measure)},500)}let l=document.getElementById("variance-range"+chartId),r=document.getElementById("variance-top"+chartId),d=document.getElementById("variance-coverage"+chartId),o=document.getElementById("variance-topselect"+chartId),s=document.getElementById("topSpan"+chartId),c=document.getElementById("coverageSpan"+chartId);if(void 0!=t[a].entitySelection.topN)r.checked=!0,d.checked=!1,o.value=t[a].entitySelection.topN,l.setAttribute("disabled","disabled"),o.removeAttribute("disabled"),null!=s&&s.classList.remove("disable"),null!=c&&c.classList.add("disable");else{r.checked=!1,d.checked=!0;let e=t[a].entitySelection.coverage;e=parseInt(e.replace(/%/,"")),l.value=e;let n=document.querySelector("#coverageSpan"+chartId+" .slide-span");null!=n&&(n.style.left=e-8+"%",n.innerHTML=e),l.removeAttribute("disabled"),o.setAttribute("disabled","disabled"),null!=s&&s.classList.add("disable"),null!=c&&c.classList.remove("disable")}}else if("correlations"==t[a].analysisType){e.correlations=!0;let n=document.getElementById("low"+chartId);n.value=t[a].thresholds.low;let i=document.getElementById("strong"+chartId);i.value=t[a].thresholds.strong;let l=document.querySelector("#outofbox-tabsection"+chartId+"  span.highlight-first"),r=document.querySelector("#outofbox-tabsection"+chartId+"  span.highlight-sencond"),d=document.querySelector("#outofbox-tabsection"+chartId+"  span.rangefirst"),o=document.querySelector("#outofbox-tabsection"+chartId+"  span.rangesecond"),s=Number(n.value);s=10*s*10,l.style.left=s+"%";let c=10*Number(10*i.value);r.style.left=c+"%",d.style.left=s+3+"%",d.innerHTML=t[a].thresholds.low,o.style.left=c+3+"%",o.innerHTML=t[a].thresholds.strong;let m=document.getElementById("measure-container"+chartId);t[a].measures.length>0&&(m.innerHTML="");for(let e=0;e<t[a].measures.length;e++)if((null!=m||void 0!=m)&&(e>=1&&(document.getElementById("removemeasure-header"+chartId).style.display="inline-block"),measureColumn.length>0)){let n=2,i=document.createElement("div");i.setAttribute("id","measure"+e+chartId),i.setAttribute("class","measure"),m.appendChild(i);for(let l=0;l<n;l++){let n=document.createElement("select");n.setAttribute("id","select"+l+chartId),i.appendChild(n);for(let i=0;i<measureColumn.length;i++){let r=document.createElement("option");r.value=measureColumn[i],r.text=measureColumn[i],t[a].measures[e][l]==measureColumn[i]&&(r.selected=!0),n.appendChild(r)}}}}else if("timeSeriesAnalysis"==t[a].analysisType){e.timeSeriesAnalysis=!0;let n=document.querySelector("#timeSeries"+chartId+'  input[type="range"]');n.value=t[a].sensitivity;let i=document.querySelector("#timeSeries"+chartId+"  span.slide-span");i.innerHTML=t[a].sensitivity;let l=Number(n.value);i.style.left=l-8+"%"}if(a==t.length-1){if(void 0==e.descriptiveStats){document.getElementById("stats"+chartId).classList.remove("active"),document.querySelector('input[name="stats'+chartId+'"]').checked=!1}if(void 0==e.timeSeriesAnalysis){document.getElementById("timeSeries"+chartId).classList.remove("active"),document.querySelector('input[name="timeSeries'+chartId+'"]').checked=!1}if(void 0==e.varianceAnalysis){document.getElementById("variance"+chartId).classList.remove("active"),document.querySelector('input[name="variance'+chartId+'"]').checked=!1}if(void 0==e.correlations){document.getElementById("correlations"+chartId).classList.remove("active"),document.querySelector('input[name="correlations'+chartId+'"]').checked=!1}}}}else{document.getElementById("stats"+chartId).classList.remove("active"),document.querySelector('input[name="stats'+chartId+'"]').checked=!1,document.getElementById("timeSeries"+chartId).classList.remove("active"),document.querySelector('input[name="timeSeries'+chartId+'"]').checked=!1,document.getElementById("variance"+chartId).classList.remove("active"),document.querySelector('input[name="variance'+chartId+'"]').checked=!1,document.getElementById("correlations"+chartId).classList.remove("active"),document.querySelector('input[name="correlations'+chartId+'"]').checked=!1}}}summaryCheckBtn.onchange=function(){if(!window.navigator.onLine)return void showModal("You are offline. Please check that you are connected to the Internet",chartId);let e=document.getElementById("accordian-summary"+chartId);this.checked&&(e.classList.add("active"),generateSummaryText("summary"),ootb_generateBtn.hasAttribute("disabled")&&ootb_generateBtn.removeAttribute("disabled",!0))},keyInsightsCheckBtn.onchange=function(){if(!window.navigator.onLine)return void showModal("You are offline. Please check that you are connected to the Internet",chartId);let e=document.getElementById("accordian-summary"+chartId);this.checked&&(e.classList.add("active"),generateSummaryText("keyInsights"),ootb_generateBtn.hasAttribute("disabled")&&ootb_generateBtn.removeAttribute("disabled",!0))},everythingCheckBtn.onchange=function(){if(!window.navigator.onLine)return void showModal("You are offline. Please check that you are connected to the Internet",chartId);let e=document.getElementById("accordian-summary"+chartId);this.checked&&(e.classList.add("active"),generateSummaryText("everything"),ootb_generateBtn.hasAttribute("disabled")&&ootb_generateBtn.removeAttribute("disabled",!0))},_this["callNarration"+chartId]=!0})}})}csv_columnData=[],csv_columnData.push("_ID"),hypercube.qDimensionInfo.forEach(function(e){columnsArr.push(e.qFallbackTitle),csv_columnData.push(e.qFallbackTitle)}),this.backendApi.getProperties().then(function(e){for(var t="_"+e.qInfo.qId,a=e.qHyperCubeDef.qMeasures,n=0;n<a.length;n++){measuresList.push(a[n].qDef.qDef);var i=a[n].qDef.qDef.split("(")[1].split(")");if(-1!==i[0].indexOf("[")){var l=i[0].split("[");l=l[1].split("]"),-1===columnsArr.indexOf(l[0])&&(columnsArr.push(l[0]),csv_columnData.push(l[0]))}else-1===columnsArr.indexOf(i[0])&&(columnsArr.push(i[0]),csv_columnData.push(i[0]))}getDataSet(t)})},resize:function(e,t){var a,n=$(this.$element[0]).find(".container").attr("id").split("_")[1],i=document.querySelector('div[tid="'+n+'"]'),l=0,r=$("#qlikContainer"+(n="_"+n));r&&(l=r.width()),maximize=!0,void 0!=$(".qv-gridcell.active").height()&&(maximize=!1,a=parseInt($(".qv-gridcell.active").height())-60),void 0==a&&(("edit"!==qlik.navigation.getMode()||maximize)&&(maximize=!0,document.getElementById("disable"+n).style.display="none"),i&&(a=parseInt(i.clientHeight)-60)),maximize?"edit"==qlik.navigation.getMode()&&(null!=document.querySelector("a.lui-icon--remove")?document.getElementById("disable"+n).style.display="none":document.getElementById("disable"+n).style.display="block"):"edit"==qlik.navigation.getMode()&&(document.getElementById("disable"+n).style.display="block"),void 0!==a&&($("#qlikContainer"+n).css({height:a+"px"}),$("#narrative-section"+n).css({height:a+"px"})),l>=840&&$("#responsive-840qlikContainer"+n).remove(),l>=765&&l>=641&&$("#responsive-765qlikContainer"+n).remove(),l>=760&&$("#responsive-760qlikContainer"+n).remove(),l>=640&&$("#responsive-640qlikContainer"+n).remove(),l>=540&&$("#responsive-540qlikContainer"+n).remove(),l>=500&&$("#responsive-500qlikContainer"+n).remove(),l>=460&&$("#responsive-460qlikContainer"+n).remove(),l>=420&&$("#responsive-420qlikContainer"+n).remove(),l>=400&&$("#responsive-400qlikContainer"+n).remove(),l>=340&&$("#responsive-340qlikContainer"+n).remove();var d="#"+r[0].id+" ",o="#840"+r[0].id;if(l<=840){if(!$(o).length){var s="";s+=d+".outofbox-tabsection .entity-selction p:first-child{text-align:left;margin-left:0px;}",$("<style id=840"+r[0].id+">").html(s).appendTo("head")}}else $("#840"+r[0].id).remove();var c="#765"+r[0].id;if(l<=765&&l>=641){if(!$(c).length){var m="";m+=(d="#qlikContainer"+n+" ")+".measure-list span { display: block; text-align: center; margin-bottom: 8px; }",m+=d+".variance .col-md-4 label{display:block; margin-bottom: 8px;}",$("<style id=765"+r[0].id+">").html(m).appendTo("head")}}else $("#765"+r[0].id).remove();var u="#760"+r[0].id;if(l<=760){if(!$(u).length){m="";m+=(d="#qlikContainer"+n+" ")+".narrative-tabsection .auth-header .col-md-8,"+d+".narrative-tabsection .auth-header .col-md-4 { width: 100% !important; padding-right: 0px; padding-left: 0px; }",$("<style id=760"+r[0].id+">").html(m).appendTo("head")}}else $("#760"+r[0].id).remove();var p="#640_OOTB"+r[0].id;if(l<=640){if(!$(p).length){m="";m+=d+".outofbox-tabsection .entity-selction p{margin-left:0px!important}",m+=d+".card-field .col-md-6{text-align:left!important}",m+=d+".tell-data .card-content .col-md-12:first-child .col-md-6,.tell-data .card-content .col-md-12:first-child .col-md-6 p{margin-bottom:0px!important}",m+=d+".tell-data .card-content .col-md-6{width:100%!important;text-align:left!important}",m+=d+".measure-list .col-md-4{width:100%!important}",m+=d+".tell-data .card-content .col-md-12:first-child .col-md-6 p:last-child{margin-left:15%}",m+=d+".measure-list{margin-top:20px}",m+=d+".col-md-12.measure-list.text-center{text-align:left!important}",m+=d+".measure-list .col-md-4 select{width:62%!important}",m+=d+".measure-list .col-md-4 input{width:60%}",m+=d+".measure-list .col-md-4 span{width:30%;display:inline-block}",m+=d+".tell-what .col-md-6{width:100%!important}",m+=d+".outofbox-tabsection .stats .card-content .col-md-6:first-child{text-align:left!important}",m+=d+".targetbasedvariance .col-md-4 label{width:30%;display:inline-block}",m+=d+".targetbasedvariance .col-md-4{width:100%!important}",m+=d+".targetbasedvariance .col-md-4:nth-child(2) select{width:60%!important;margin-left:10px!important}",m+=d+".entity-selction p{width:100%!important}",m+=d+".timebasedvariance .col-md-4{width:100%!important}",m+=d+".variance .col-md-4 label{width:30%;display:inline-block}",m+=d+".multiple-range.col-md-8,"+d+".correlations .col-md-8{width:100%!important}",m+=d+".measure-list span{text-align:left;}",m+=d+".measure-list.text-left{text-align:left;}",m+=d+"div.distribution:last-child { display: block; margin-left: 52px !important; }",m+=d+".timebasedvariance, "+d+".targetbasedvariance{text-align:left !important;}",m+=d+".outofbox-tabsection .variance .col-md-4 select{width: 60%;padding: 5px;height:auto;}",m+=d+".outofbox-tabsection .entity-selction p:first-child{text-align:left;}",m+=d+".outofbox-tabsection .correlations .card-content .col-md-8:first-child p { float: none; display: block; text-align: left; }",m+=d+".outofbox-tabsection .correlations .card-content .col-md-8:first-child .measure-container{text-align:left;display: block;}",m+=d+".card .card-content .measure-list.text-center select{margin-left:12px !important}",m+=d+".multiple-range label { margin-top: 40px; }",$("<style id=640_OOTB"+r[0].id+">").html(m).appendTo("head")}}else $("#640_OOTB"+r[0].id).remove();var y="#540_OOTB"+r[0].id;if(l<=540){if(!$(y).length){var h="";h+=d+".tell-data .card-content .col-md-12:first-child .col-md-6 p:last-child{margin-left:10%}",h+=d+".tell-data .card-content .col-md-6:last-child p:first-child{margin-left:5%!important}",h+=d+"#correlations"+n+" .multiple-range label {margin-top: 40px;}",$("<style id=540_OOTB"+r[0].id+">").html(h).appendTo("head")}}else $("#540_OOTB"+r[0].id).remove();var g="#500_OOTB"+r[0].id;if(l<=500){if(!$(g).length){h="";h+=d+".multiple-range label{margin-top:40px}",h+=d+".accordian-summary span { display: block; text-align: left; }",$("<style id=500_OOTB"+r[0].id+">").html(h).appendTo("head")}}else $("#500_OOTB"+r[0].id).remove();var v="#640_simple"+r[0].id;if(l<640){if(!$(v).length){s="";s+=d+".studio-options .col-md-3,"+d+".studio-options .col-md-9{display:block;width:100%!important}",s+=d+".studio-options .col-md-9 p:first-child{margin:0!important}",s+=d+".studio-options .col-md-9 p{display:block!important;margin:10px 0px !important;}",s+=d+".edit-mapsection{display:inline-block!important}",s+=d+".export,"+d+".data-json,"+d+".csvload{width:100%!important;margin-bottom:10px}",s+=d+".edit-mapsection .export,"+d+".edit-mapsection .data-json{float:none!important}",s+=d+"footer{text-align:center;position:relative;min-height:100px;margin-bottom:10px}",s+=d+"footer .col-md-2{width:100%!important;text-align:center;position:absolute;bottom:0;right:0;left:0}",s+=d+"footer .col-md-10.text-right{text-align:center!important;width:100%!important}",s+=d+".dynamic-header .auth-header .col-md-4{padding-right:0}",s+=d+".dynamic-header .col-md-4,.dynamic-header .col-md-8{width:100%!important}",s+=d+".studio-type{width:100%!important;position:relative;margin-top:15px;float:none}",s+=d+".studio-type .col-md-3{width:15%!important;float:left;text-align:right;margin-top:10px}",s+=d+".studio-type .col-md-9{width:69%!important;float:left;padding-left:25px}",s+=d+".studio-type .col-md-9 p{margin-bottom:10px!important}",s+=d+".simple-mode .studio-options .col-md-3 p{margin-bottom:16px;}",s+=d+".edit-mapsection{padding-bottom: 0px;}",$("<style id=640_simple"+r[0].id+">").html(s).appendTo("head")}}else $("#640_simple"+r[0].id).remove();var I="#460"+r[0].id;if(l<=460){if(!$(I).length){s="";s+=d+".outofbox-tabsection .distribution-container .distribution:first-child p:last-child { margin-left: 62px; }",s+=d+".multiple-range label,"+d+".multiple-range label input{width: 320px !important;}",s+=d+".increase-container span { display: block; margin-bottom: 15px; }"+d+".tell-data .card-content .col-md-6:last-child p { display: block; float: left; }"+d+".card-content .col-md-6:last-child p.good-container { margin-left: 0px !important; }",s+=d+".tab-header button { margin-top: 30px; }",s+=d+".tab-header a{top:initial;transform: translateY(-0%);}",$("<style id=460"+r[0].id+">").html(s).appendTo("head")}}else $("#460"+r[0].id).remove();var b="#420_simple"+r[0].id;if(l<420){if(!$(b).length){s="";s+=d+".studio-type .col-md-9{width:60%!important}"+d+".studio-type .col-md-3{width:24 %!important}",s+=d+".multiple-range label,"+d+" .multiple-range label input{width: 260px !important;}",$("<style id=420_simple"+r[0].id+">").html(s).appendTo("head")}}else $("#420_simple"+r[0].id).remove();var E="#400_header"+r[0].id;if(l<400){if(!$(E).length){s="";s+=d+"header .tab-header button{padding: 8px 2px !important;font-size:12px !important;}",$("<style id=400_header"+r[0].id+">").html(s).appendTo("head")}}else $("#400_header"+r[0].id).remove();var w="#340_header"+r[0].id;if(l<340){if(!$(w).length){s="";s+=d+".openstudio_btn{margin: 7px 5px 10px 0px;padding: 4px 10px;font-size: 12px;}",s+=d+".generate_btn{margin: 7px 0;padding: 4px 10px; font-size: 12px;}",$("<style id=340_header"+r[0].id+">").html(s).appendTo("head")}}else $("#340_header"+r[0].id).remove();var f=document.getElementById("tell-what"+n),D=document.getElementById("qlikContainer"+n).clientWidth;if("block"==f.style.display&&D>640){let e=document.querySelector("#tell-what"+n+" .multiple-range span:first-child").clientWidth,t=document.querySelector("#tell-what"+n+" .multiple-range").clientWidth-e-20;document.querySelector("#tell-what"+n+" .multiple-range label").style.width=t+"px";let a=document.querySelectorAll("#tell-what"+n+" .multi-range");a[0].style.width=t+"px",a[1].style.width=t+"px"}}}});